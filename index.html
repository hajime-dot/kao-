<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Gogogo é«˜é›„</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#FFFFFF">
<link rel="apple-touch-icon" href="https://img.icons8.com/color/180/taiwan-map.png">

<style>
    :root {
        /* Palette: Fresh & Light */
        --bg-body: #F5F7FA;
        --bg-card: #FFFFFF;
        
        --primary: #4ECDC4; /* Tiffany/Mint Green */
        --primary-dark: #36B0A8;
        --secondary: #FF6B6B; /* Soft Coral for alerts/money */
        
        --text-main: #2D3436;
        --text-light: #636E72;
        --text-lighter: #B2BEC3;

        /* Category Colors */
        --cat-food-bg: #FFF3E0; --cat-food-text: #FF9800;
        --cat-spot-bg: #E8F5E9; --cat-spot-text: #4CAF50;
        --cat-transport-bg: #E3F2FD; --cat-transport-text: #2196F3;
        --cat-hotel-bg: #F3E5F5; --cat-hotel-text: #9C27B0;

        --shadow-soft: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.01);
        --radius-l: 24px;
        --radius-m: 16px;
        --radius-s: 12px;
        
        --nav-height: 85px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg-body);
        margin: 0; padding: 0;
        display: flex; justify-content: center;
        height: 100dvh; color: var(--text-main);
        overflow: hidden;
    }

    #app-container {
        width: 100%; max-width: 500px;
        background-color: var(--bg-body);
        height: 100%; position: relative;
        display: flex; flex-direction: column;
    }

    /* --- Header & Countdown --- */
    header { 
        padding: 50px 24px 10px; 
        background: var(--bg-body);
        flex-shrink: 0; 
    }
    
    .header-top { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 20px; }
    h1 { margin: 0; font-size: 32px; font-weight: 800; letter-spacing: -0.5px; color: var(--text-main); background: -webkit-linear-gradient(45deg, #2D3436, #636E72); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    
    /* Countdown Widget */
    .countdown-box {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        padding: 20px; border-radius: var(--radius-l);
        color: white; margin-bottom: 10px;
        box-shadow: 0 10px 20px -5px rgba(78, 205, 196, 0.4);
        position: relative; overflow: hidden;
    }
    .countdown-box::after {
        content: "âœˆï¸"; position: absolute; right: -10px; bottom: -10px; font-size: 80px; opacity: 0.2; transform: rotate(-15deg);
    }
    .cd-label { font-size: 13px; font-weight: 600; opacity: 0.9; margin-bottom: 8px; letter-spacing: 1px; text-transform: uppercase;}
    .cd-timer { display: flex; gap: 15px; }
    .cd-item { text-align: center; }
    .cd-num { font-size: 28px; font-weight: 800; line-height: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .cd-unit { font-size: 10px; opacity: 0.8; font-weight: 500; margin-top: 2px;}

    #main-content {
        flex: 1; overflow-y: auto;
        padding: 10px 24px 110px; /* Bottom padding for nav */
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }
    #main-content::-webkit-scrollbar { display: none; }

    /* --- Date Tabs --- */
    .date-scroll {
        display: flex; gap: 12px; overflow-x: auto;
        padding: 5px 2px 20px 2px;
    }
    .date-scroll::-webkit-scrollbar { display: none; }
    
    .date-chip {
        background: var(--bg-card); padding: 12px 20px; border-radius: 30px;
        font-size: 14px; white-space: nowrap; color: var(--text-light);
        box-shadow: 0 4px 10px rgba(0,0,0,0.03); font-weight: 600; cursor: pointer;
        border: 1px solid transparent; transition: all 0.2s ease;
    }
    .date-chip.active { 
        background: var(--text-main); color: white; 
        box-shadow: 0 8px 15px rgba(0,0,0,0.15); 
        transform: translateY(-2px);
    }

    /* --- Cards --- */
    .card {
        background: var(--bg-card); border-radius: var(--radius-l); padding: 20px;
        margin-bottom: 20px; box-shadow: var(--shadow-soft);
        position: relative; border: 1px solid rgba(0,0,0,0.02);
        transition: transform 0.2s;
    }
    .card:active { transform: scale(0.98); }

    /* Category Badges */
    .cat-badge {
        display: inline-flex; align-items: center; justify-content: center;
        padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 700;
        margin-bottom: 8px; letter-spacing: 0.5px;
    }
    .type-food .cat-badge { background: var(--cat-food-bg); color: var(--cat-food-text); }
    .type-spot .cat-badge { background: var(--cat-spot-bg); color: var(--cat-spot-text); }
    .type-transport .cat-badge { background: var(--cat-transport-bg); color: var(--cat-transport-text); }
    .type-hotel .cat-badge { background: var(--cat-hotel-bg); color: var(--cat-hotel-text); }

    .card-time { font-size: 14px; color: var(--text-main); font-weight: 800; float: right; opacity: 0.6; }
    .card-title { font-size: 18px; font-weight: 800; margin: 5px 0 8px; color: var(--text-main); line-height: 1.3; }
    .card-desc { font-size: 14px; color: var(--text-light); line-height: 1.6; margin-bottom: 12px; }
    
    /* Tags */
    .tags-row { margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 6px; }
    .tag { display: inline-block; font-size: 10px; padding: 4px 8px; border-radius: 6px; font-weight: 700; background: #F0F2F5; color: var(--text-light); }
    .tag-booking { background: #FFF0F1; color: var(--secondary); }

    .btn-nav {
        display: flex; align-items: center; justify-content: center;
        background: #F8F9FA; color: var(--text-main); 
        padding: 10px; border-radius: var(--radius-m);
        text-decoration: none; font-size: 13px; font-weight: 700; 
        transition: background 0.2s;
    }
    .btn-nav:active { background: #E9ECEF; }

    /* --- Money Section --- */
    .money-input-group { 
        background: var(--bg-card); padding: 24px; border-radius: var(--radius-l); 
        box-shadow: var(--shadow-soft); margin-bottom: 24px; 
    }
    
    .input-field {
        width: 100%; padding: 14px 16px; border: none; border-radius: var(--radius-m);
        font-size: 16px; background: #F5F7FA; color: var(--text-main);
        transition: box-shadow 0.2s; font-family: inherit;
        margin-bottom: 12px;
    }
    .input-field:focus { box-shadow: 0 0 0 2px var(--primary); background: white; }
    
    .member-checks { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0 20px; }
    .member-chip { 
        padding: 8px 14px; border-radius: 20px; background: #F5F7FA; color: var(--text-light);
        font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; user-select: none;
    }
    .member-chip.checked { background: var(--text-main); color: white; transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

    .btn-add { 
        width: 100%; background: var(--text-main); color: white; border: none; 
        padding: 16px; border-radius: var(--radius-m); font-size: 16px; font-weight: 700; 
        cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transition: transform 0.1s;
    }
    .btn-add:active { transform: scale(0.98); }

    /* Balance Cards */
    .balance-card { 
        background: white; border-radius: var(--radius-m); padding: 16px; margin-bottom: 12px; 
        display: flex; justify-content: space-between; align-items: center; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
    }
    .is-plus { color: #00B894; background: #E0F7FA; padding: 4px 8px; border-radius: 6px; }
    .is-minus { color: #FF7675; background: #FFF0F0; padding: 4px 8px; border-radius: 6px; }

    .history-item { 
        padding: 14px 0; border-bottom: 1px solid #F0F2F5; 
        display: flex; justify-content: space-between; align-items: center; 
    }
    .btn-delete { 
        background: #FFF0F0; border: none; color: #FF7675; 
        width: 32px; height: 32px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-size: 16px; cursor: pointer; margin-left: 10px;
    }

    /* --- Navigation --- */
    .bottom-nav {
        position: absolute; bottom: 20px; left: 20px; right: 20px; height: 70px;
        background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
        display: flex; justify-content: space-around; align-items: center;
        border-radius: 35px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        z-index: 100;
        max-width: 460px; margin: 0 auto;
    }
    .nav-item { flex: 1; text-align: center; color: #B2BEC3; transition: all 0.2s; }
    .nav-item.active { color: var(--text-main); transform: translateY(-2px); }
    .nav-icon { font-size: 24px; display: block; margin-bottom: 2px;}
    .nav-label { font-size: 10px; font-weight: 700; letter-spacing: 0.5px; }

    .section { display: none; animation: fadeIn 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* Flight Info */
    .info-header { font-size: 12px; font-weight: 800; color: var(--text-lighter); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; margin-top: 20px;}
    .info-block { background: white; border-radius: var(--radius-m); padding: 20px; box-shadow: var(--shadow-soft); margin-bottom: 15px;}
    .flight-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; border-bottom: 1px solid #F5F7FA; padding-bottom: 12px;}
    .flight-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
    
</style>
</head>
<body>

<div id="app-container">
    <header>
        <div class="header-top">
            <h1>Gogogo é«˜é›„</h1>
            <div style="font-size:24px;">ğŸ‡¹ğŸ‡¼</div>
        </div>
        
        <div class="countdown-box" id="countdown-ui">
            <div class="cd-label">Time until Takeoff</div>
            <div class="cd-timer">
                <div class="cd-item"><div class="cd-num" id="cd-d">--</div><div class="cd-unit">DAYS</div></div>
                <div class="cd-item"><div class="cd-num" id="cd-h">--</div><div class="cd-unit">HRS</div></div>
                <div class="cd-item"><div class="cd-num" id="cd-m">--</div><div class="cd-unit">MIN</div></div>
            </div>
        </div>
    </header>

    <div id="main-content">
        
        <div id="sec-itinerary" class="section active">
            <div class="date-scroll" id="date-tabs"></div>
            <div id="cards-container" style="padding-top:10px;"></div>
        </div>

        <div id="sec-money" class="section">
            <div class="money-input-group">
                <h3 style="margin-top:0; margin-bottom:20px; font-size:20px;">æ–°å¢æ”¯å‡º (Add Expense)</h3>
                
                <input type="text" id="m-desc" class="input-field" placeholder="é …ç›® (e.g. æ™šé¤, é–€ç¥¨)">
                
                <div style="display:flex; gap:10px;">
                    <input type="number" id="m-amt" class="input-field" placeholder="é‡‘é¡ ($)" style="flex:1">
                    <div style="position:relative; flex:1;">
                        <select id="m-payer" class="input-field" style="appearance:none; padding-right:30px;">
                            </select>
                        <span style="position:absolute; right:15px; top:15px; color:#aaa; pointer-events:none;">â–¼</span>
                    </div>
                </div>

                <div style="margin-top:10px; margin-bottom:5px; font-size:12px; font-weight:bold; color:#aaa; display:flex; justify-content:space-between;">
                    <span>åˆ†æ”¤è€… (Split with)</span>
                    <span onclick="toggleAllChecks()" style="color:var(--primary-dark); cursor:pointer;">å…¨é¸ / å–æ¶ˆ</span>
                </div>
                <div id="m-targets" class="member-checks">
                    </div>

                <button class="btn-add" onclick="addExpense()">ï¼‹ è¨˜ä¸€ç­†</button>
            </div>

            <div class="info-header">çµé¤˜ (Balance Status)</div>
            <div id="balance-list"></div>
            
            <div class="info-header">ç´€éŒ„ (History)</div>
            <div id="history-list" style="background:white; padding:10px 20px; border-radius:var(--radius-m); box-shadow:var(--shadow-soft);"></div>
            
            <div style="text-align:center; margin-top:30px; margin-bottom:20px;">
                <button onclick="clearAllData()" style="background:none; border:none; color:#B2BEC3; font-size:12px; font-weight:600;">âš ï¸ æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>
            </div>
        </div>

        <div id="sec-info" class="section">
            <div class="info-header">ä½å®¿ (Accommodation)</div>
            <div class="card type-hotel" style="margin-bottom:20px;">
                <div class="cat-badge">HOTEL</div>
                <div class="card-title">æ„›æ²³â€§æ—¥å¤® B&B</div>
                <div class="card-desc">é«˜é›„å¸‚å‰é‡‘å€ â€¢ Check-in 15:00</div>
                <a href="https://www.google.com/maps/search/?api=1&query=æ„›æ²³æ—¥å¤®" target="_blank" class="btn-nav">ğŸ“ é–‹å•Ÿå°èˆª</a>
            </div>

            <div class="info-header">èˆªç­è³‡è¨Š (Flights)</div>
            
            <div class="info-block">
                <div style="font-weight:800; margin-bottom:15px; color:var(--text-main); display:flex; align-items:center;">
                    <span style="font-size:18px; margin-right:8px;">ğŸ‡­ğŸ‡°</span> é¦™æ¸¯ â†” é«˜é›„
                </div>
                
                <div class="flight-row">
                    <div>
                        <div style="font-weight:700; color:var(--text-main);">19/2 ğŸ›« 10:30</div>
                        <div style="color:var(--text-light); font-size:12px;">AE984 / CI934</div>
                    </div>
                    <div style="text-align:right; font-size:12px; font-weight:600; color:var(--text-lighter);">
                        å¥, æ°´, æŸ, é‚¦
                    </div>
                </div>

                <div class="flight-row">
                    <div>
                        <div style="font-weight:700; color:var(--text-main);">20/2 ğŸ›« 10:30</div>
                        <div style="color:var(--text-light); font-size:12px;">CI934</div>
                    </div>
                    <div style="text-align:right; font-size:12px; font-weight:600; color:var(--text-lighter);">
                        åˆ (é²ä¸€å¤©)
                    </div>
                </div>

                <div class="flight-row">
                    <div>
                        <div style="font-weight:700; color:var(--text-main);">23/2 ğŸ›¬ 18:00</div>
                        <div style="color:var(--text-light); font-size:12px;">CI935</div>
                    </div>
                    <div style="text-align:right; font-size:12px; font-weight:600; color:var(--text-lighter);">
                        å…¨å“¡å›æ¸¯
                    </div>
                </div>
            </div>

            <div class="info-block">
                <div style="font-weight:800; margin-bottom:15px; color:var(--text-main); display:flex; align-items:center;">
                    <span style="font-size:18px; margin-right:8px;">ğŸ‡»ğŸ‡³</span> èƒ¡å¿—æ˜ â†” é«˜é›„
                </div>
                
                <div class="flight-row">
                    <div>
                        <div style="font-weight:700; color:var(--text-main);">19/2 ğŸ›« 07:35</div>
                        <div style="color:var(--text-light); font-size:12px;">VJ886</div>
                    </div>
                    <div style="text-align:right; font-size:12px; font-weight:600; color:var(--text-lighter);">
                        å®œ (Boyi)
                    </div>
                </div>

                <div class="flight-row">
                    <div>
                        <div style="font-weight:700; color:var(--text-main);">23/2 ğŸ›¬ 12:45</div>
                        <div style="color:var(--text-light); font-size:12px;">VJ885</div>
                    </div>
                    <div style="text-align:right; font-size:12px; font-weight:600; color:var(--text-lighter);">
                        å®œ (Boyi)
                    </div>
                </div>
            </div>

            <div class="info-header">æ—…ä¼´ (Travelers)</div>
            <div style="padding:10px 0; color:var(--text-light); font-size:14px; line-height:1.6;">
                æ°´, é‚¦, å¥, åˆ, æŸ, Boyi, çª, Sean (å…±8äºº)
            </div>
        </div>

    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('sec-itinerary', this)">
            <span class="nav-icon">ğŸ—“ï¸</span><span class="nav-label">è¡Œç¨‹</span>
        </div>
        <div class="nav-item" onclick="switchTab('sec-money', this)">
            <span class="nav-icon">ğŸ’¸</span><span class="nav-label">å…¬æ•¸</span>
        </div>
        <div class="nav-item" onclick="switchTab('sec-info', this)">
            <span class="nav-icon">ğŸ§³</span><span class="nav-label">è³‡è¨Š</span>
        </div>
    </nav>
</div>

<script>
    // === 0. Countdown Timer Logic ===
    function startCountdown() {
        // Target: 2026/02/19 10:30:00 (Flight Time)
        const targetDate = new Date("2026-02-19T10:30:00").getTime();

        const timer = setInterval(function() {
            const now = new Date().getTime();
            const distance = targetDate - now;

            if (distance < 0) {
                clearInterval(timer);
                document.getElementById("countdown-ui").innerHTML = "<div style='text-align:center; font-weight:800; font-size:24px;'>ENJOY KAOHSIUNG! ğŸ‰</div>";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));

            document.getElementById("cd-d").innerText = days;
            document.getElementById("cd-h").innerText = hours;
            document.getElementById("cd-m").innerText = minutes;
        }, 1000);
    }
    startCountdown();

    // === 1. Data Source ===
    const members = ['æ°´', 'é‚¦', 'å¥', 'åˆ', 'æŸ', 'Boyi', 'çª', 'Sean'];
    
    const itinerary = [
        {
            date: "02/19 (å››)",
            events: [
                { time: "10:30", title: "èµ·é£› HKG->KHH", type: "transport", desc: "å¥æ°´æŸé‚¦å‡ºç™¼ (CI934)ã€‚", loc: "é¦™æ¸¯åœ‹éš›æ©Ÿå ´" },
                { time: "13:00", title: "å°æ¸¯æ©Ÿå ´é›†åˆ", type: "transport", desc: "èˆ‡ Boyi æœƒåˆã€‚", loc: "é«˜é›„å°æ¸¯æ©Ÿå ´" },
                { time: "15:00", title: "é£¯åº— Check-in", type: "hotel", desc: "è¡Œææ”¾ç½®ã€‚", loc: "æ„›æ²³æ—¥å¤®" },
                { time: "19:30", title: "é…’è‚‰æ­¦æ—", type: "food", desc: "æ™šé¤æ™‚å…‰ã€‚", loc: "é…’è‚‰æ­¦æ—", tags: ["BOOKING"] }
            ]
        },
        {
            date: "02/20 (äº”)",
            events: [
                { time: "08:30", title: "å¤§ã„ã„¡èƒ–ç¢³çƒ¤ä¸‰æ˜æ²»", type: "food", desc: "æ—©é¤ã€‚", loc: "å¤§ã„ã„¡èƒ–ç¢³çƒ¤ä¸‰æ˜æ²»" },
                { time: "10:00", title: "é§äºŒè—è¡“ç‰¹å€", type: "spot", desc: "åˆ (Cho) 12:00 æŠµé”å¾Œæœƒåˆã€‚", loc: "é§äºŒè—è¡“ç‰¹å€" },
                { time: "12:00", title: "CODA coffee", type: "food", desc: "ğŸš¶ æ­¥è¡Œç´„ 6 åˆ†é˜ã€‚", loc: "CODA coffee", tags: ["WALK 6M"] },
                { time: "13:15", title: "ç§»å‹•ï¼šå…¬äº¤ 56A", type: "transport", desc: "ğŸšŒ å‰å¾€å‹•ç‰©åœ’ã€‚", loc: "56Aå…¬è»Šç«™", tags: ["BUS 56A"] },
                { time: "13:30", title: "å£½å±±å‹•ç‰©åœ’", type: "spot", desc: "çœ‹æ°´è±šã€‚", loc: "å£½å±±å‹•ç‰©åœ’" },
                { time: "16:45", title: "ç§»å‹•ï¼šå…¬äº¤ 56A", type: "transport", desc: "ğŸšŒ å‰å¾€åºœåŒ—è·¯ç«™ã€‚", loc: "åºœåŒ—è·¯å…¬è»Šç«™", tags: ["BUS 56A"] },
                { time: "17:15", title: "æ–°å €æ±Ÿ / å¤¾å­åœ’", type: "spot", desc: "å¤¾å¨ƒå¨ƒã€é’èœæ¨‚åœ’ã€‚", loc: "æ–°å €æ±Ÿå•†åœˆ" },
                { time: "19:40", title: "éŠ…èŠ±ç²¾ç·»æ¶®æ¶®é‹", type: "food", desc: "é«˜ç´šæ™šé¤ã€‚", loc: "éŠ…èŠ±ç²¾ç·»æ¶®æ¶®é‹", tags: ["BOOKING"] }
            ]
        },
        {
            date: "02/21 (å…­)",
            events: [
                { time: "09:00", title: "èˆˆéš†å±…", type: "food", desc: "æ—©é¤ã€‚", loc: "èˆˆéš†å±…" },
                { time: "10:30", title: "Mystoto å¯†å®¤é€ƒè„«", type: "spot", desc: "è§£è¬æŒ‘æˆ°ã€‚", loc: "Mystotoå¯†å®¤é€ƒè„«", tags: ["BOOKING"] },
                { time: "12:10", title: "ç‚¸è¨˜ (åˆé¤)", type: "food", desc: "ğŸš¶ æ­¥è¡Œç´„ 10 åˆ†é˜ã€‚", loc: "ç‚¸è¨˜", tags: ["WALK 10M"] },
                { time: "13:30", title: "SKM Park / è³½é“", type: "spot", desc: "å¡ä¸è»Šã€‚", loc: "SKM Park" },
                { time: "18:45", title: "ç§»å‹•ï¼šæ·é‹ç´…ç·š", type: "transport", desc: "ğŸš‡ å‰å¾€ä¸‰å¤šå•†åœˆã€‚", loc: "ä¸‰å¤šå•†åœˆç«™", tags: ["METRO"] },
                { time: "19:15", title: "è‹“é›…å¸‚å ´ / è‡ªå¼·å¤œå¸‚", type: "food", desc: "åœ¨åœ°ç¾é£Ÿã€‚", loc: "è‡ªå¼·å¤œå¸‚" },
                { time: "21:00", title: "ä¸æƒ³æ´—é ­â€¢è¶Šå¼æ´—é«®", type: "spot", desc: "æŒ‰æ‘©æ”¾é¬†ã€‚", loc: "ä¸æƒ³æ´—é ­è¶Šå¼æ´—é«®", tags: ["BOOKING"] }
            ]
        },
        {
            date: "02/22 (æ—¥)",
            events: [
                { time: "07:00", title: "æ™¨é–“æ¢³æ´—", type: "hotel", desc: "æº–å‚™å‡ºç™¼ã€‚", loc: "æ„›æ²³æ—¥å¤®" },
                { time: "08:00", title: "å¤§ç”°æ—©é¤åº—", type: "food", desc: "ğŸš¶ æ­¥è¡Œç´„ 3 åˆ†é˜ã€‚", loc: "å¤§ç”°æ—©é¤åº—", tags: ["WALK 3M"] },
                { time: "10:30", title: "ç¾æ¿ƒä¸€æ—¥éŠ", type: "spot", desc: "ğŸš— Uber è»Šç¨‹ç´„ 80åˆ†ã€‚", loc: "ç¾æ¿ƒæ°‘ä¿—æ‘", tags: ["UBER 80M"] },
                { time: "17:40", title: "é˜¿é¦™çš„å»šæˆ¿", type: "food", desc: "è¾¦æ¡Œæ–™ç† (Booked)ã€‚", loc: "é˜¿é¦™çš„å»šæˆ¿", tags: ["BOOKING"] },
                { time: "20:30", title: "è¿”å›ä¼‘æ¯", type: "hotel", desc: "ä¼‘æ¯å……é›»ã€‚", loc: "æ„›æ²³æ—¥å¤®" }
            ]
        },
        {
            date: "02/23 (ä¸€)",
            events: [
                { time: "07:30", title: "Check-out", type: "hotel", desc: "æ¢³æ´— & é€€æˆ¿ã€‚", loc: "æ„›æ²³æ—¥å¤®" },
                { time: "09:00", title: "æ™¨é–“å»šæˆ¿", type: "food", desc: "ğŸ‘‹ èˆ‡ Boyi é“åˆ¥ã€‚", loc: "æ™¨é–“å»šæˆ¿å‰é‡‘æˆåŠŸåº—" },
                { time: "10:00", title: "ä¿®è£œéºæ†¾æ™‚é–“", type: "spot", desc: "æœ€å¾Œè³¼ç‰©ã€‚", loc: "é«˜é›„å¸‚" },
                { time: "12:00", title: "Boyi å‰å¾€æ©Ÿå ´", type: "transport", desc: "âœˆï¸ Boyi 12:45 èµ·é£›ã€‚", loc: "å°æ¸¯æ©Ÿå ´", tags: ["VJ885"] },
                { time: "16:00", title: "æŠµé”æ©Ÿå ´ (HKçµ„)", type: "transport", desc: "è¾¦ç†ç™»æ©Ÿã€‚", loc: "å°æ¸¯æ©Ÿå ´" },
                { time: "18:00", title: "è¿”ç¨‹ CI935", type: "transport", desc: "âœˆï¸ KHH -> HKGã€‚", loc: "å°æ¸¯æ©Ÿå ´", tags: ["HOME"] }
            ]
        }
    ];

    // === 2. Core Init & Itinerary Logic ===
    function init() { 
        renderDateTabs(); 
        renderCards(0); 
        initMoneySection();
        updateBalance();
    }

    function renderDateTabs() {
        const container = document.getElementById('date-tabs');
        itinerary.forEach((day, index) => {
            const chip = document.createElement('div');
            chip.className = `date-chip ${index === 0 ? 'active' : ''}`;
            chip.innerText = day.date.split(' ')[0];
            chip.onclick = () => {
                document.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                renderCards(index);
            };
            container.appendChild(chip);
        });
    }

    function renderCards(dayIndex) {
        const container = document.getElementById('cards-container');
        container.innerHTML = '';
        itinerary[dayIndex].events.forEach(event => {
            const card = document.createElement('div');
            card.className = `card type-${event.type}`;
            
            let badgeText = event.type.toUpperCase();
            
            let tagsHtml = event.tags ? event.tags.map(tag => {
                let cls = 'tag';
                if(tag.includes('BOOKING')) cls = 'tag tag-booking';
                return `<span class="${cls}">${tag}</span>`;
            }).join('') : '';
            
            const mapLink = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(event.loc);
            card.innerHTML = `
                <div class="cat-badge">${badgeText}</div>
                <span class="card-time">${event.time}</span>
                <div class="card-title">${event.title}</div>
                <div class="card-desc">${event.desc}</div>
                ${tagsHtml ? `<div class="tags-row">${tagsHtml}</div>` : ''}
                <a href="${mapLink}" target="_blank" class="btn-nav">ğŸ“ é–‹å•Ÿåœ°åœ–å°èˆª</a>
            `;
            container.appendChild(card);
        });
    }

    function switchTab(sectionId, navElement) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        navElement.classList.add('active');
    }

    // === 3. Money / Expense Logic ===
    let expenses = JSON.parse(localStorage.getItem('khh_expenses')) || [];

    window.deleteExpense = function(id) {
        if(confirm("ç¢ºå®šåˆªé™¤é€™ç­†ç´€éŒ„ï¼Ÿ")) {
            expenses = expenses.filter(e => e.id !== id);
            saveAndRender();
        }
    }

    function initMoneySection() {
        const payerSelect = document.getElementById('m-payer');
        const targetDiv = document.getElementById('m-targets');
        
        payerSelect.innerHTML = '';
        targetDiv.innerHTML = '';
        
        members.forEach((m) => {
            let opt = document.createElement('option');
            opt.value = m;
            opt.innerText = m;
            payerSelect.appendChild(opt);

            let chip = document.createElement('div');
            chip.className = 'member-chip checked';
            chip.innerText = m;
            chip.dataset.name = m;
            chip.onclick = function() { this.classList.toggle('checked'); };
            targetDiv.appendChild(chip);
        });
    }

    window.toggleAllChecks = function() {
        const all = document.querySelectorAll('.member-chip');
        const anyUnchecked = Array.from(all).some(el => !el.classList.contains('checked'));
        all.forEach(el => {
            if(anyUnchecked) el.classList.add('checked');
            else el.classList.remove('checked');
        });
    }

    window.addExpense = function() {
        const desc = document.getElementById('m-desc').value;
        const amt = parseFloat(document.getElementById('m-amt').value);
        const payer = document.getElementById('m-payer').value;
        const checkedEls = document.querySelectorAll('.member-chip.checked');
        const targets = Array.from(checkedEls).map(el => el.dataset.name);

        if(!desc || isNaN(amt) || targets.length === 0) {
            alert("è«‹è¼¸å…¥é …ç›®ã€é‡‘é¡ï¼Œä¸¦è‡³å°‘é¸æ“‡ä¸€å€‹åˆ†æ”¤è€…ã€‚");
            return;
        }

        const expense = {
            id: Date.now(),
            desc: desc,
            amt: amt,
            payer: payer,
            targets: targets,
            timestamp: new Date().toLocaleString()
        };

        expenses.push(expense);
        saveAndRender();
        
        document.getElementById('m-desc').value = '';
        document.getElementById('m-amt').value = '';
    }

    window.clearAllData = function() {
        if(confirm("âš ï¸ è­¦å‘Šï¼šé€™å°‡åˆªé™¤æ‰€æœ‰è¨˜å¸³è³‡æ–™ä¸”ç„¡æ³•å¾©åŸï¼ç¢ºå®šå—ï¼Ÿ")) {
            expenses = [];
            saveAndRender();
        }
    }

    function saveAndRender() {
        localStorage.setItem('khh_expenses', JSON.stringify(expenses));
        updateBalance();
    }

    function updateBalance() {
        let balances = {};
        members.forEach(m => balances[m] = 0);

        const historyDiv = document.getElementById('history-list');
        historyDiv.innerHTML = '';

        expenses.forEach(exp => {
            balances[exp.payer] += exp.amt;
            const splitAmt = exp.amt / exp.targets.length;
            exp.targets.forEach(t => {
                if(balances[t] !== undefined) balances[t] -= splitAmt;
            });

            let item = document.createElement('div');
            item.className = 'history-item';
            item.innerHTML = `
                <div style="flex:1;">
                    <div style="font-weight:700; color:var(--text-main); font-size:15px;">${exp.desc} <span style="font-weight:400; color:var(--text-light);">$${exp.amt}</span></div>
                    <div style="font-size:12px; color:var(--text-lighter); margin-top:4px;">${exp.payer} ä»˜æ¬¾ â†’ ${exp.targets.length} äºº</div>
                </div>
                <button class="btn-delete" type="button" onclick="deleteExpense(${exp.id})">âœ–</button>
            `;
            historyDiv.prepend(item);
        });

        const balDiv = document.getElementById('balance-list');
        balDiv.innerHTML = '';
        
        let sortedMembers = Object.keys(balances).sort((a,b) => balances[b] - balances[a]);

        sortedMembers.forEach(m => {
            const val = balances[m];
            if(Math.abs(val) < 1) return;

            let row = document.createElement('div');
            row.className = 'balance-card';
            const isPlus = val > 0;
            
            row.innerHTML = `
                <div>
                    <div style="font-weight:700; font-size:15px;">${m}</div>
                    <div style="font-size:11px; color:#B2BEC3;">${isPlus ? 'æ‡‰æ”¶ (GET)' : 'æ‡‰ä»˜ (PAY)'}</div>
                </div>
                <div style="font-weight:700; font-size:16px;" class="${isPlus ? 'is-plus' : 'is-minus'}">
                    ${isPlus ? '+' : ''}${Math.round(val)}
                </div>
            `;
            balDiv.appendChild(row);
        });
        
        if(expenses.length === 0) {
            historyDiv.innerHTML = '<div style="text-align:center; color:#ddd; font-size:12px;">å°šç„¡ç´€éŒ„</div>';
        }
    }

    init();

</script>
</body>
</html>
