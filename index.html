<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Gogogo È´òÈõÑ</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#FFFFFF">
<link rel="apple-touch-icon" href="https://img.icons8.com/color/180/taiwan-map.png">

<style>
    :root {
        --bg-body: #F7F9FC;
        --bg-card: #FFFFFF;
        
        --primary: #4ECDC4; 
        --primary-dark: #36B0A8;
        --secondary: #FF6B6B; 
        
        --text-main: #2C3E50;
        --text-light: #7F8C8D;
        --text-lighter: #BDC3C7;

        --shadow-soft: 0 4px 20px rgba(0,0,0,0.05);
        --radius-l: 20px;
        --radius-m: 14px;
        --radius-s: 8px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg-body);
        margin: 0; padding: 0;
        display: flex; justify-content: center;
        height: 100dvh; color: var(--text-main);
        overflow: hidden;
    }

    #app-container {
        width: 100%; max-width: 500px;
        background-color: var(--bg-body);
        height: 100%; position: relative;
        display: flex; flex-direction: column;
    }

    /* --- 1. Header (Static) --- */
    header { 
        padding: 40px 20px 10px; 
        background: var(--bg-body);
        flex-shrink: 0;
        text-align: center;
    }
    h1 { 
        margin: 0; font-size: 24px; font-weight: 800; 
        color: var(--text-main); letter-spacing: 1px;
    }

    /* --- 2. Top Nav (Tabs) --- */
    .top-nav {
        display: flex; padding: 0 15px; margin-bottom: 5px;
        background: var(--bg-body); flex-shrink: 0;
        position: relative; z-index: 10;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .nav-item {
        flex: 1; text-align: center; padding: 12px 0;
        font-size: 14px; font-weight: 600; color: var(--text-lighter);
        cursor: pointer; position: relative; transition: color 0.2s;
    }
    .nav-item.active { color: var(--text-main); font-weight: 700; }
    .nav-item.active::after {
        content: ''; position: absolute; bottom: 0; left: 25%; right: 25%;
        height: 3px; background: var(--primary); border-radius: 3px 3px 0 0;
    }

    /* --- 3. Content Area --- */
    #main-content {
        flex: 1; overflow-y: auto;
        padding: 10px 20px 40px; 
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }
    #main-content::-webkit-scrollbar { display: none; }

    .section { display: none; animation: fadeIn 0.3s ease; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    /* --- Itinerary Components --- */
    .date-scroll {
        display: flex; gap: 10px; overflow-x: auto; 
        padding: 10px 2px 15px; position: sticky; top: 0;
        background: var(--bg-body); z-index: 5;
    }
    .date-scroll::-webkit-scrollbar { display: none; }
    
    .date-chip {
        background: white; padding: 10px 16px; border-radius: 20px;
        font-size: 13px; white-space: nowrap; color: var(--text-light);
        box-shadow: 0 2px 8px rgba(0,0,0,0.03); font-weight: 600;
        border: 1px solid transparent; transition: all 0.2s;
    }
    .date-chip.active { 
        background: var(--text-main); color: white; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateY(-1px);
    }

    .card {
        background: var(--bg-card); border-radius: var(--radius-m); padding: 18px;
        margin-bottom: 14px; box-shadow: var(--shadow-soft);
        position: relative; border-left: 4px solid #ddd;
    }
    
    /* Card Types */
    .type-food { border-left-color: #F39C12; }
    .type-spot { border-left-color: #27AE60; }
    .type-transport { border-left-color: #3498DB; background: #F8FBFF; }
    .type-hotel { border-left-color: #9B59B6; }

    .card-row-top { display: flex; justify-content: space-between; margin-bottom: 6px; }
    .card-time { font-family: monospace; font-size: 14px; font-weight: 700; color: var(--text-main); }
    
    .card-title { font-size: 16px; font-weight: 800; color: var(--text-main); margin-bottom: 6px; line-height: 1.4; }
    .card-desc { font-size: 13px; color: var(--text-light); line-height: 1.5; margin-bottom: 8px; }

    /* Tags */
    .tags-row { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .tag { font-size: 10px; padding: 4px 8px; border-radius: 6px; font-weight: 700; text-transform: uppercase; }
    .tag-walk { background: #E8F5E9; color: #2E7D32; } /* Walking */
    .tag-uber { background: #E8EAF6; color: #3F51B5; } /* Car/Uber */
    .tag-metro { background: #FFF3E0; color: #E67E22; } /* Public Transport */
    .tag-book { background: #FFEBEE; color: #C0392B; } /* Booking */

    /* Must Do Box */
    .must-do-box {
        margin-top: 12px; padding: 8px 12px;
        background: #FFFDE7; color: #795548;
        font-size: 12px; border-radius: 8px;
        display: flex; align-items: flex-start; gap: 6px;
        line-height: 1.4; font-weight: 500;
        border: 1px solid #FFF59D;
    }

    .btn-map { 
        float: right; margin-top: -5px; font-size: 12px; 
        background: #F0F3F4; padding: 6px 12px; border-radius: 20px; 
        color: var(--text-main); text-decoration: none; font-weight: 600; 
    }
    .btn-map-info {
        display: inline-block; font-size: 13px; 
        background: var(--primary); color: white;
        padding: 8px 16px; border-radius: 20px;
        text-decoration: none; font-weight: bold;
        margin-top: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* --- Money Section --- */
    .input-group { background: white; padding: 20px; border-radius: var(--radius-l); box-shadow: var(--shadow-soft); margin-bottom: 20px; }
    .form-input { width: 100%; padding: 12px; border: 1px solid #EEE; border-radius: 10px; margin-bottom: 10px; font-size: 15px; }
    .check-grid { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0 15px; }
    .check-item { padding: 6px 12px; border-radius: 15px; background: #F5F7FA; font-size: 12px; color: #999; cursor: pointer; border: 1px solid transparent; }
    .check-item.checked { background: var(--text-main); color: white; border-color: var(--text-main); }
    
    .sel-btn-row { display: flex; gap: 10px; margin-bottom: 8px; }
    .sel-btn { font-size: 11px; padding: 4px 10px; background: #EEE; border:none; border-radius: 4px; color: #666; cursor: pointer; }

    /* --- Countdown Section --- */
    #sec-countdown { text-align: center; padding-top: 40px; }
    .cd-circle {
        width: 220px; height: 220px; margin: 0 auto 30px;
        border-radius: 50%; border: 4px solid var(--primary);
        display: flex; flex-direction: column; justify-content: center;
        box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
    }
    .cd-num { font-size: 60px; font-weight: 800; color: var(--text-main); line-height: 1; }
    .cd-txt { font-size: 14px; color: var(--text-light); text-transform: uppercase; letter-spacing: 2px; }

</style>
</head>
<body>

<div id="app-container">
    <header>
        <h1>Gogogo È´òÈõÑ üáπüáº</h1>
    </header>

    <nav class="top-nav">
        <div class="nav-item active" onclick="switchTab('sec-itinerary', this)">Ë°åÁ®ã</div>
        <div class="nav-item" onclick="switchTab('sec-money', this)">ÂÖ¨Êï∏</div>
        <div class="nav-item" onclick="switchTab('sec-countdown', this)">ÂÄíÊï∏</div>
        <div class="nav-item" onclick="switchTab('sec-info', this)">Ë≥áË®ä</div>
    </nav>

    <div id="main-content">
        
        <div id="sec-itinerary" class="section active">
            <div class="date-scroll" id="date-tabs"></div>
            <div id="cards-container"></div>
        </div>

        <div id="sec-money" class="section">
            <div class="input-group">
                <input type="text" id="m-desc" class="form-input" placeholder="Ê∂àË≤ªÈ†ÖÁõÆ (e.g. ÊôöÈ§ê)">
                <div style="display:flex; gap:10px;">
                    <input type="number" id="m-amt" class="form-input" placeholder="ÈáëÈ°ç ($)">
                    <select id="m-payer" class="form-input"><option>‰ªòÊ¨æ‰∫∫</option></select>
                </div>
                
                <div class="sel-btn-row">
                    <button class="sel-btn" onclick="toggleAllChecks(true)">ÂÖ®ÈÅ∏</button>
                    <button class="sel-btn" onclick="toggleAllChecks(false)">ÂÖ®‰∏çÈÅ∏</button>
                </div>
                <div id="m-targets" class="check-grid"></div>
                
                <button onclick="addExpense()" style="width:100%; padding:12px; background:var(--text-main); color:white; border:none; border-radius:10px; font-weight:bold;">Ë®òÂ∏≥</button>
            </div>
            <div id="balance-list" style="margin-bottom:20px;"></div>
            <div id="history-list"></div>
            <button onclick="clearAllData()" style="width:100%; margin-top:20px; background:none; border:none; color:#ccc;">Ê∏ÖÈô§ÊâÄÊúâÁ¥ÄÈåÑ</button>
        </div>

        <div id="sec-countdown" class="section">
            <div id="pre-flight">
                <div class="cd-circle">
                    <div class="cd-num" id="cd-d">--</div>
                    <div class="cd-txt">Days Left</div>
                </div>
                <div style="font-size:18px; color:var(--text-main); font-weight:600;">Ë∑ùÈõ¢ 2Êúà19Êó• Âá∫Áôº</div>
                <div style="font-family:monospace; margin-top:10px; color:var(--primary-dark); font-size:20px;">
                    <span id="cd-h">00</span>:<span id="cd-m">00</span>:<span id="cd-s">00</span>
                </div>
            </div>
            <div id="post-flight" style="display:none;">
                <div style="font-size:80px;">üéâ</div>
                <h2>ÊóÖÈÄîÊÑâÂø´!</h2>
                <p>Welcome to Kaohsiung</p>
            </div>
        </div>

        <div id="sec-info" class="section">
            <div class="card type-hotel">
                <div class="card-title">ÊÑõÊ≤≥‚ÄßÊó•Â§Æ B&B</div>
                <div class="card-desc">È´òÈõÑÂ∏ÇÂâçÈáëÂçÄ ‚Ä¢ Check-in 15:00</div>
                <a href="https://www.google.com/maps/search/?api=1&query=%E6%84%9B%E6%B2%B3%E6%97%A5%E5%A4%AE%20%E9%AB%98%E9%9B%84" target="_blank" class="btn-map-info">üìç Â∞éËà™Ëá≥Ê∞ëÂÆø</a>
            </div>
            <div class="card type-transport">
                <div class="card-title">Ëà™Áè≠Ë≥áË®ä</div>
                <div class="card-desc">
                    <b>HKG ‚Üî KHH (CI934/CI935)</b><br>
                    ÂéªÁ®ã: 19/2 10:30 (ÂÅ•Ê∞¥ÊüèÈÇ¶)<br>
                    ÂõûÁ®ã: 23/2 18:00 (ÂÖ®Âì°)<br><br>
                    <b>SGN ‚Üî KHH (VJ886/VJ885)</b><br>
                    Boyi: 19/2 07:35 ÊäµÈÅî / 23/2 12:45 Èõ¢Èñã
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // === Data & Config ===
    const members = ['Ê∞¥', 'ÈÇ¶', 'ÂÅ•', 'Âàù', 'Êüè', 'Boyi', 'Áê™', 'Sean'];
    
    // Helper to generate tag HTML based on content
    const makeTags = (list) => {
        if(!list) return '';
        return list.map(t => {
            let cls = 'tag-metro';
            if(t.includes('Ë°å')) cls = 'tag-walk';
            if(t.includes('Uber') || t.includes('Ëªä')) cls = 'tag-uber';
            if(t.includes('book') || t.includes('Book')) cls = 'tag-book';
            return `<span class="tag ${cls}">${t}</span>`;
        }).join('');
    };

    const itinerary = [
        {
            date: "19/2 (Âõõ)",
            events: [
                { time: "10:30", end: "12:00", title: "Ëµ∑È£õ HKG->KHH", type: "transport", desc: "ÂÅ•Ê∞¥ÊüèÈÇ¶Âá∫Áôº (CI934)", tags: ["HKG Airport"], must: "Check passport! Ë≤∑ÂÆö Sim Âç°" },
                { time: "13:00", end: "14:00", title: "Â∞èÊ∏ØÊ©üÂ†¥ÈõÜÂêà", type: "transport", desc: "Ëàá Boyi ÊúÉÂêà", tags: ["KHH Airport"], must: "È†òÈå¢ / ÊÇ†ÈÅäÂç°Âä†ÂÄº" },
                { time: "15:00", end: "", title: "Check-in ‰ºëÊÅØ", type: "hotel", desc: "ÊÑõÊ≤≥Êó•Â§Æ B&B", tags: ["Uber"], loc: "ÊÑõÊ≤≥Êó•Â§Æ", must: "Êîæ‰ΩéË°åÊùéÔºå‰∫´ÂèóË®≠Ë®àÊÑüÁ©∫Èñì" },
                { time: "19:30", end: "21:30", title: "ÈÖíËÇâÊ≠¶Êûó", type: "food", desc: "ÁáíËÇâÊôöÈ§ê", tags: ["Booking", "Uber"], must: "ÂøÖÈªûÔºöÂ£∫Êº¨ÁâõËÇãÊ¢ù„ÄÅËî•ÈπΩÁâõËàå" }
            ]
        },
        {
            date: "20/2 (‰∫î)",
            events: [
                { time: "07:30", end: "08:30", title: "Ê¢≥Ê¥ó", type: "hotel", desc: "Ê∫ñÂÇôÂá∫ÈñÄ", tags: [], must: "Ë®òÂæóÊêΩÈò≤Êõ¨" },
                { time: "08:30", end: "09:30", title: "Â§ß„Ñé„Ñ°ËÉñÁ¢≥ÁÉ§‰∏âÊòéÊ≤ª", type: "food", desc: "‰∫∫Ê∞£Êó©È§ê", tags: ["Ë°å 6ÂàÜÈêò"], must: "ÊãõÁâåÁ¢≥ÁÉ§ÂúüÂè∏ + ÈÆÆÂ•∂Ëå∂" },
                { time: "10:00", end: "11:45", title: "ÈßÅ‰∫åËóùË°ìÁâπÂçÄ", type: "spot", desc: "ÊñáÂâµÂúíÂçÄÊº´Ê≠•", tags: ["Ë°å 14ÂàÜÈêò"], must: "ÂæÆÁÜ±Â±±‰∏òÊãøÈ≥≥Ê¢®ÈÖ•„ÄÅÂ§ßÊ∏ØÊ©ãÊâìÂç°" },
                { time: "12:00", end: "13:00", title: "CODA coffee", type: "food", desc: "ÂçàÈ§êÊôÇÈñì", tags: ["Ë°å 6ÂàÜÈêò"], must: "ÊâãÊ≤ñÂíñÂï° / ËÇâÊ°ÇÊç≤" },
                { time: "13:30", end: "16:30", title: "Â£ΩÂ±±ÂãïÁâ©Âúí", type: "spot", desc: "Join Âàù„ÄÅÁê™„ÄÅÊ≠°Ëªä", tags: ["Bus 56A"], must: "Êé¢Ë®™Ê∞¥Ë±öÂêõ„ÄÅÊê≠‰πòÈÅäÂúíÂ∞èÁÅ´Ëªä" },
                { time: "17:15", end: "19:00", title: "Êñ∞Â†ÄÊ±üÂïÜÂúà / Â§æÂ≠êÂúí", type: "spot", desc: "ÈùíËèúÊ®ÇÂúí", tags: ["Bus 56A", "Uber 15m"], must: "Â§æÈõ∂È£ü„ÄÅÂ§©‰ΩøÈõûÊéí" },
                { time: "19:40", end: "21:30", title: "ÈäÖËä±Á≤æÁ∑ªÊ∂ÆÊ∂ÆÈçã", type: "food", desc: "Ë±™ËèØÁÅ´Èçã", tags: ["Booked", "Uber 24m"], must: "ÊúÄÂæåÁöÑÈªÉÈáëÁ®ÄÈ£Ø (ÈõúÁÇä) ÊòØÊú¨È´î" },
                { time: "22:00", end: "~~", title: "ËøîÂéª‰ºëÊÅØ", type: "hotel", desc: "ÊôöÂÆâ", tags: ["Uber 15m"], loc: "ÊÑõÊ≤≥Êó•Â§Æ", must: "Êä¨ËÖø‰ºëÊÅØ" }
            ]
        },
        {
            date: "21/2 (ÂÖ≠)",
            events: [
                { time: "07:30", end: "08:30", title: "Ê¢≥Ê¥ó", type: "hotel", desc: "Good Morning", tags: [], must: "Â∏∂Ë°åÂãïÈõªÊ∫ê" },
                { time: "09:00", end: "10:00", title: "ËààÈöÜÂ±Ö", type: "food", desc: "ÂÇ≥Áµ±Êó©È§ê", tags: ["Ë°å 15ÂàÜÈêò"], must: "ÂøÖÈ£üÊπØÂåÖ (Ë¶ÅÊéíÈöä)„ÄÅÁáíÈ§Ö" },
                { time: "10:30", end: "12:00", title: "Mystoto ÂØÜÂÆ§ÈÄÉËÑ´", type: "spot", desc: "ÁáíËÖ¶ÊôÇÈñì", tags: ["Booked", "ËºïËªå C205"], must: "ÂÖ®È´îÂêà‰ΩúÔºå‰∏çË¶ÅÂêµÊû∂ XD" },
                { time: "12:10", end: "13:00", title: "ÁÇ∏Ë®ò (Lunch)", type: "food", desc: "ÂçàÈ§ê", tags: ["Ë°å 10ÂàÜÈêò"], must: "ÈÖ•ËÑÜÁÇ∏ÈõûË£úÂÖÖÁÜ±Èáè" },
                { time: "13:30", end: "18:45", title: "SKM Park / Ë≥ΩÈÅìÊ®ÇÂúí", type: "spot", desc: "Outlet + Âç°‰∏ÅËªä", tags: ["Á¥ÖÁ∑ö->ËçâË°ôÁ´ô"], must: "Èà¥ÈπøË≥ΩÈÅìÂç°‰∏ÅËªäÈ£ÜËªä„ÄÅË≤∑Èûã" },
                { time: "19:15", end: "20:30", title: "Ëá™Âº∑Â§úÂ∏Ç / ËãìÈõÖÂ∏ÇÂ†¥", type: "food", desc: "Âú®Âú∞Â∞èÂêÉÊôöÈ§ê", tags: ["Á¥ÖÁ∑ö->‰∏âÂ§ö"], must: "ÂçóË±êÈ≠ØËÇâÈ£Ø„ÄÅÁôΩÁ≥ñÁ≤ø" },
                { time: "21:00", end: "22:15", title: "Ë∂äÂºèÊ¥óÈ´Æ", type: "spot", desc: "‰∏çÊÉ≥Ê¥óÈ†≠ (SPA)", tags: ["Booked", "Uber 14m"], must: "ÂÖ®Â•óÊîæÈ¨Ü SPA" },
                { time: "22:30", end: "~~", title: "ËøîÂéª‰ºëÊÅØ", type: "hotel", desc: "ÊôöÂÆâ", tags: ["Uber 9m"], loc: "ÊÑõÊ≤≥Êó•Â§Æ", must: "Êï∑ÂÄãÈù¢ËÜú" }
            ]
        },
        {
            date: "22/2 (Êó•)",
            events: [
                { time: "08:00", end: "09:00", title: "Â§ßÁî∞Êó©È§êÂ∫ó", type: "food", desc: "Êó©È§ê", tags: ["Ë°å 3ÂàÜÈêò"], must: "Âè§Êó©Âë≥Á≤âÊºøËõãÈ§Ö" },
                { time: "10:30", end: "16:00", title: "ÁæéÊøÉ‰∏ÄÊó•ÈÅä", type: "spot", desc: "ÂÆ¢ÂÆ∂ÊñáÂåñ / Á¥ôÂÇò", tags: ["Uber 80m"], must: "Áï´Á¥ôÂÇòÈ´îÈ©ó„ÄÅÈ£üÂÆ¢ÂÆ∂Á≤ÑÊ¢ù" },
                { time: "17:40", end: "19:30", title: "ÈòøÈ¶ôÁöÑÂªöÊàø", type: "food", desc: "Âéü‰ΩèÊ∞ëÊñôÁêÜ", tags: ["Booked"], must: "Âà∫Ëî•ÁÉòËõã„ÄÅÂ±±Ë±¨ËÇâ" },
                { time: "20:30", end: "~~", title: "ËøîÂéª‰ºëÊÅØ", type: "hotel", desc: "Êï¥ÁêÜË°åÊùé", tags: ["Uber"], loc: "ÊÑõÊ≤≥Êó•Â§Æ", must: "Á¢∫Ë™çË≠∑ÁÖß„ÄÅÂü∑Ë°åÊùé" }
            ]
        },
        {
            date: "23/2 (‰∏Ä)",
            events: [
                { time: "07:30", end: "09:00", title: "Check-out", type: "hotel", desc: "Êî∂ÊãæË°åÊùé", tags: [], must: "Ê™¢Êü•ÊúâÁÑ°ÈÅ∫ÁïôÁâ©ÂìÅ" },
                { time: "09:00", end: "10:00", title: "Êô®ÈñìÂªöÊàø", type: "food", desc: "ÊúÄÂæåÊó©È§ê", tags: ["ÂâçÈáëÊàêÂäüÂ∫ó"], must: "ÁÇíÊ≥°È∫µ„ÄÅËõãÈ§Ö" },
                { time: "12:45", end: "", title: "Boyi È£õÊ©ü (VJ885)", type: "transport", desc: "Âπ≥ÂÆâÂõûÂÆ∂", tags: ["To SGN"], loc: "È´òÈõÑÂ∞èÊ∏ØÊ©üÂ†¥", must: "Safe Flight!" },
                { time: "16:00", end: "", title: "HKÁµÑ Ê©üÂ†¥Â†±Âà∞", type: "transport", desc: "CI935", tags: ["KHH Airport"], loc: "È´òÈõÑÂ∞èÊ∏ØÊ©üÂ†¥", must: "ÊúÄÂæåË°ùÂà∫Ë≤∑Êâã‰ø°" }
            ]
        }
    ];

    // === App Logic ===
    function init() {
        renderDateTabs();
        renderCards(0);
        initMoney();
        startCountdown();
    }

    function switchTab(secId, navEl) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(secId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        navEl.classList.add('active');
    }

    // --- Itinerary ---
    function renderDateTabs() {
        const c = document.getElementById('date-tabs');
        itinerary.forEach((d, i) => {
            const chip = document.createElement('div');
            chip.className = `date-chip ${i===0?'active':''}`;
            chip.innerText = d.date.split(' ')[0];
            chip.onclick = () => {
                document.querySelectorAll('.date-chip').forEach(x=>x.classList.remove('active'));
                chip.classList.add('active');
                renderCards(i);
            }
            c.appendChild(chip);
        });
    }

    function renderCards(idx) {
        const c = document.getElementById('cards-container');
        c.innerHTML = '';
        const day = itinerary[idx];
        day.events.forEach(ev => {
            const card = document.createElement('div');
            card.className = `card type-${ev.type}`;
            
            // Time logic
            let timeHtml = `<span class="card-time">${ev.time}</span>`;
            if(ev.end) timeHtml += `<span style="font-size:12px; color:#999; margin-left:5px;">- ${ev.end}</span>`;
            
            // Tags logic
            const tagsHtml = ev.tags && ev.tags.length > 0 ? `<div class="tags-row">${makeTags(ev.tags)}</div>` : '';
            
            // Must Do logic
            const mustHtml = ev.must ? `<div class="must-do-box">üí° ${ev.must}</div>` : '';

            // Map link: Use explicit 'loc' if present, otherwise use title + È´òÈõÑ
            const queryLoc = ev.loc ? ev.loc : (ev.title + " È´òÈõÑ");
            const mapUrl = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(queryLoc);

            card.innerHTML = `
                <div class="card-row-top">
                    <div>${timeHtml}</div>
                    <a href="${mapUrl}" target="_blank" class="btn-map">GO</a>
                </div>
                <div class="card-title">${ev.title}</div>
                <div class="card-desc">${ev.desc}</div>
                ${mustHtml}
                ${tagsHtml}
            `;
            c.appendChild(card);
        });
    }

    // --- Money ---
    let expenses = JSON.parse(localStorage.getItem('khh_data_v2')) || [];
    function initMoney() {
        const sel = document.getElementById('m-payer');
        const box = document.getElementById('m-targets');
        members.forEach(m => {
            sel.innerHTML += `<option value="${m}">${m}</option>`;
            box.innerHTML += `<div class="check-item checked" onclick="this.classList.toggle('checked')">${m}</div>`;
        });
        updateMoneyUI();
    }
    
    // Select All / None Logic
    window.toggleAllChecks = function(isCheck) {
        document.querySelectorAll('.check-item').forEach(el => {
            if(isCheck) el.classList.add('checked');
            else el.classList.remove('checked');
        });
    }

    window.addExpense = function() {
        const desc = document.getElementById('m-desc').value;
        const amt = parseFloat(document.getElementById('m-amt').value);
        const payer = document.getElementById('m-payer').value;
        const targets = Array.from(document.querySelectorAll('.check-item.checked')).map(e=>e.innerText);
        
        if(!desc || isNaN(amt) || payer === '‰ªòÊ¨æ‰∫∫') return alert('Ë´ãÂ°´ÂØ´ÂÆåÊï¥');
        if(targets.length === 0) return alert('Ë´ãËá≥Â∞ëÈÅ∏Êìá‰∏Ä‰∫∫ÂàÜÊìî');

        expenses.unshift({id: Date.now(), desc, amt, payer, targets});
        saveMoney();
        document.getElementById('m-desc').value = '';
        document.getElementById('m-amt').value = '';
    }
    function saveMoney() {
        localStorage.setItem('khh_data_v2', JSON.stringify(expenses));
        updateMoneyUI();
    }
    window.clearAllData = function() {
        if(confirm('Á¢∫ÂÆöÊ∏ÖÈô§ÊâÄÊúâË®òÂ∏≥Ë≥áÊñôÔºü')) { expenses = []; saveMoney(); }
    }
    function updateMoneyUI() {
        const list = document.getElementById('history-list');
        list.innerHTML = '';
        let bals = {}; members.forEach(m => bals[m] = 0);
        
        expenses.forEach(e => {
            bals[e.payer] += e.amt;
            const split = e.amt / e.targets.length;
            e.targets.forEach(t => bals[t] -= split);
            
            list.innerHTML += `
                <div style="padding:10px 0; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                    <div><b>${e.desc}</b> $${e.amt} <span style="font-size:11px; color:#999;">(${e.payer})</span></div>
                    <div style="color:red; cursor:pointer;" onclick="delExp(${e.id})">‚úï</div>
                </div>`;
        });
        window.delExp = (id) => { if(confirm('Âà™Èô§?')) { expenses=expenses.filter(x=>x.id!==id); saveMoney(); }};
        
        const balDiv = document.getElementById('balance-list');
        balDiv.innerHTML = '';
        Object.keys(bals).sort((a,b)=>bals[b]-bals[a]).forEach(m => {
            if(Math.abs(bals[m]) < 1) return;
            const val = Math.round(bals[m]);
            const color = val > 0 ? '#27AE60' : '#C0392B';
            balDiv.innerHTML += `
                <div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #f9f9f9;">
                    <span>${m}</span>
                    <span style="color:${color}; font-weight:bold;">${val>0?'+':''}${val}</span>
                </div>`;
        });
    }

    // --- Countdown ---
    function startCountdown() {
        const target = new Date("2026-02-19T10:30:00").getTime();
        setInterval(() => {
            const now = new Date().getTime();
            const diff = target - now;
            
            if(diff < 0) {
                document.getElementById('pre-flight').style.display = 'none';
                document.getElementById('post-flight').style.display = 'block';
                return;
            }
            
            document.getElementById('cd-d').innerText = Math.floor(diff / (1000*60*60*24));
            document.getElementById('cd-h').innerText = String(Math.floor((diff % (1000*60*60*24))/(1000*60*60))).padStart(2,'0');
            document.getElementById('cd-m').innerText = String(Math.floor((diff % (1000*60*60))/(1000*60))).padStart(2,'0');
            document.getElementById('cd-s').innerText = String(Math.floor((diff % (1000*60))/1000)).padStart(2,'0');
        }, 1000);
    }

    init();
</script>
</body>
</html>
