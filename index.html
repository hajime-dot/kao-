<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Gogogo Kaohsiung</title>

<style>
    :root {
        --apple-bg: #F2F2F7;
        --apple-card: rgba(255, 255, 255, 0.85);
        --apple-blue: #007AFF;
        --apple-green: #34C759;
        --apple-red: #FF3B30;
        --apple-text: #1C1C1E;
        --apple-secondary: #8E8E93;
        --radius-ios: 20px;
        --blur: blur(20px);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
        background-color: var(--apple-bg);
        color: var(--apple-text);
        margin: 0; display: flex; justify-content: center;
        height: 100dvh; overflow: hidden; letter-spacing: -0.02em;
    }

    #app-container {
        width: 100%; max-width: 500px; height: 100%;
        display: flex; flex-direction: column;
        position: relative;
    }

    /* --- Apple Header --- */
    header {
        padding: 60px 20px 20px;
        background: rgba(242, 242, 247, 0.8);
        backdrop-filter: var(--blur);
        -webkit-backdrop-filter: var(--blur);
        position: sticky; top: 0; z-index: 100;
        text-align: left;
    }
    h1 { margin: 0; font-size: 34px; font-weight: 700; letter-spacing: -0.04em; }

    /* --- iOS Segmented Control --- */
    .top-nav {
        display: flex; background: rgba(118, 118, 128, 0.12);
        padding: 3px; border-radius: 10px;
        margin: 0 20px 15px; flex-shrink: 0;
    }
    .nav-item {
        flex: 1; text-align: center; padding: 8px 0;
        font-size: 13px; font-weight: 600; border-radius: 8px;
        color: var(--apple-text); cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .nav-item.active {
        background: #FFFFFF; box-shadow: 0 3px 8px rgba(0,0,0,0.12);
    }

    /* --- Content --- */
    #main-content {
        flex: 1; overflow-y: auto; padding: 0 20px 100px;
        mask-image: linear-gradient(to bottom, transparent, black 20px, black 90%, transparent);
    }
    #main-content::-webkit-scrollbar { display: none; }

    .section { display: none; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    .section.active { display: block; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* --- Cards Style --- */
    .card {
        background: var(--apple-card);
        backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur);
        border-radius: var(--radius-ios); padding: 20px;
        margin-bottom: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.04);
        border: 1px solid rgba(255,255,255,0.3);
    }
    
    .card-title { font-size: 19px; font-weight: 700; margin-bottom: 4px; }
    .card-desc { font-size: 14px; color: var(--apple-secondary); line-height: 1.4; }
    
    .must-do-pill {
        display: inline-flex; align-items: center; gap: 6px;
        background: rgba(0, 122, 255, 0.1); color: var(--apple-blue);
        padding: 6px 12px; border-radius: 100px;
        font-size: 12px; font-weight: 600; margin: 12px 0;
    }

    .btn-map {
        float: right; background: var(--apple-blue); color: white;
        padding: 6px 16px; border-radius: 100px; font-size: 13px;
        font-weight: 600; text-decoration: none;
        transition: transform 0.1s ease;
    }
    .btn-map:active { transform: scale(0.92); }

    /* --- Money Section --- */
    .ios-input {
        background: rgba(255,255,255,0.8); border: none;
        width: 100%; padding: 14px; border-radius: 12px;
        font-size: 16px; margin-bottom: 10px;
    }
    .check-grid { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
    .check-item {
        background: #E9E9EB; padding: 8px 16px; border-radius: 100px;
        font-size: 14px; color: var(--apple-text); cursor: pointer;
        transition: 0.2s;
    }
    .check-item.checked { background: var(--apple-text); color: white; }

    .resolver-box {
        background: white; border-radius: 18px; padding: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #EEE;
    }
    .balance-row {
        display: flex; justify-content: space-between; padding: 10px 0;
        border-bottom: 0.5px solid #EEE; font-size: 15px;
    }

    /* --- Date Scroller --- */
    .date-scroll { display: flex; gap: 12px; overflow-x: auto; padding: 5px 0 20px; }
    .date-scroll::-webkit-scrollbar { display: none; }
    .date-chip {
        min-width: 60px; text-align: center; background: white;
        padding: 10px; border-radius: 14px; font-size: 13px;
        color: var(--apple-secondary); box-shadow: 0 2px 6px rgba(0,0,0,0.02);
    }
    .date-chip.active { background: var(--apple-blue); color: white; font-weight: 700; }

</style>
</head>
<body>

<div id="app-container">
    <header>
        <h1>é«˜é›„ ğŸ‡¹ğŸ‡¼</h1>
    </header>

    <nav class="top-nav">
        <div class="nav-item active" onclick="switchTab('sec-itinerary', this)">è¡Œç¨‹</div>
        <div class="nav-item" onclick="switchTab('sec-money', this)">çµç®—</div>
        <div class="nav-item" onclick="switchTab('sec-info', this)">è³‡è¨Š</div>
    </nav>

    <div id="main-content">
        
        <div id="sec-itinerary" class="section active">
            <div class="date-scroll" id="date-tabs"></div>
            <div id="cards-container"></div>
        </div>

        <div id="sec-money" class="section">
            <div class="card">
                <input type="text" id="m-desc" class="ios-input" placeholder="æ¶ˆè²»é …ç›®">
                <div style="display:flex; gap:10px;">
                    <input type="number" id="m-amt" class="ios-input" placeholder="é‡‘é¡ (TWD)">
                    <select id="m-payer" class="ios-input" style="width:120px;"></select>
                </div>
                <div class="check-grid" id="m-targets"></div>
                <button onclick="addExpense()" style="width:100%; background:var(--apple-blue); color:white; border:none; padding:15px; border-radius:14px; font-size:16px; font-weight:600;">è¨˜éŒ„æ”¯å‡º</button>
            </div>

            <div class="resolver-box">
                <div style="font-weight:700; font-size:18px; margin-bottom:15px;">æœ€çµ‚çµç®—å»ºè­°</div>
                <div id="resolve-result" style="color: var(--apple-secondary); font-size:14px;">æš«ç„¡æ•¸æ“š...</div>
                <div id="balance-list" style="margin-top:20px;"></div>
            </div>

            <div id="history-list" style="margin-top:30px;"></div>
            <button onclick="clearData()" style="width:100%; padding:20px; color:var(--apple-red); background:none; border:none; font-size:13px;">é‡è¨­æ‰€æœ‰æ•¸æ“š</button>
        </div>

        <div id="sec-info" class="section">
            <div class="card">
                <div class="card-title">ğŸ¨ æ„›æ²³â€§æ—¥å¤® B&B</div>
                <div class="card-desc">Check-in: 15:00<br>å‰é‡‘å€å¸‚ä¸­ä¸€è·¯229è™Ÿ</div>
                <a href="https://www.google.com/maps/search/?api=1&query=æ„›æ²³æ—¥å¤®" target="_blank" class="btn-map" style="float:none; display:inline-block; margin-top:15px;">å°èˆªè‡³æ°‘å®¿</a>
            </div>
        </div>

    </div>
</div>

<script>
    const members = ['æ°´', 'é‚¦', 'å¥', 'åˆ', 'æŸ', 'Boyi', 'çª', 'Sean'];
    const itinerary = [
        { date: "19/2", events: [
            { time: "10:30", title: "èµ·é£› HKG", desc: "å¥æ°´æŸé‚¦ CI934", must: "è¨˜å¾—å¡«å¯«å…¥å°è­‰", type: "transport" },
            { time: "15:00", title: "Check-in", desc: "æ„›æ²³æ—¥å¤® B&B", must: "æ”¾ä½è¡Œæä¼‘æ¯ä¸€é™£", type: "hotel", loc: "æ„›æ²³æ—¥å¤®" },
            { time: "19:30", title: "é…’è‚‰æ­¦æ—", desc: "ç‡’è‚‰æ™šé¤", must: "å¿…é»å£ºæ¼¬ç‰›è‚‹æ¢", type: "food" }
        ]},
        { date: "20/2", events: [
            { time: "08:30", title: "å¤§ã„ã„¡èƒ–", desc: "ç‚­çƒ¤ä¸‰æ˜æ²»æ—©é¤", must: "å¿…å–é®®å¥¶èŒ¶", type: "food" },
            { time: "10:00", title: "é§äºŒè—è¡“å€", desc: "æ–‡å‰µæ¼«æ­¥", must: "å»å¤§æ¸¯æ©‹ç‡è½‰å‹•", type: "spot" },
            { time: "19:40", title: "éŠ…èŠ±ç«é‹", desc: "è±ªè¯æ¶®æ¶®é‹", must: "æœ€å¾Œå€‹é»ƒé‡‘ç¨€é£¯å¿…é£Ÿ", type: "food" }
        ]},
        { date: "21/2", events: [{ time: "13:30", title: "SKM Park", desc: "Outlet & å¡ä¸è»Š", must: "é£†é€Ÿé«”é©—", type: "spot" }] },
        { date: "22/2", events: [{ time: "10:30", title: "ç¾æ¿ƒä¸€æ—¥éŠ", desc: "å®¢å®¶æ–‡åŒ–é«”é©—", must: "ç•«ç´™å‚˜é«”é©—", type: "spot" }] },
        { date: "23/2", events: [{ time: "12:45", title: "Boyi é£›æ©Ÿ", desc: "å°æ¸¯æ©Ÿå ´", must: "Safe Flight!", type: "transport", loc: "é«˜é›„å°æ¸¯æ©Ÿå ´" }] }
    ];

    let expenses = JSON.parse(localStorage.getItem('khh_v4')) || [];

    function init() {
        renderDateTabs();
        renderCards(0);
        const pSel = document.getElementById('m-payer');
        const tBox = document.getElementById('m-targets');
        members.forEach(m => {
            pSel.innerHTML += `<option value="${m}">${m}</option>`;
            tBox.innerHTML += `<div class="check-item checked" onclick="this.classList.toggle('checked')">${m}</div>`;
        });
        updateUI();
    }

    function switchTab(id, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    function renderDateTabs() {
        const c = document.getElementById('date-tabs');
        itinerary.forEach((d, i) => {
            const chip = document.createElement('div');
            chip.className = `date-chip ${i===0?'active':''}`;
            chip.innerHTML = `<div style="font-size:10px;">FEB</div><div style="font-size:16px; font-weight:700;">${d.date.split('/')[0]}</div>`;
            chip.onclick = () => {
                document.querySelectorAll('.date-chip').forEach(x=>x.classList.remove('active'));
                chip.classList.add('active');
                renderCards(i);
            };
            c.appendChild(chip);
        });
    }

    function renderCards(idx) {
        const c = document.getElementById('cards-container');
        c.innerHTML = '';
        itinerary[idx].events.forEach(ev => {
            const mapUrl = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(ev.loc || ev.title);
            c.innerHTML += `
                <div class="card">
                    <a href="${mapUrl}" target="_blank" class="btn-map">GO</a>
                    <div class="card-desc" style="color:var(--apple-blue); font-weight:700; margin-bottom:4px;">${ev.time}</div>
                    <div class="card-title">${ev.title}</div>
                    <div class="card-desc">${ev.desc}</div>
                    <div class="must-do-pill">ğŸ’¡ ${ev.must}</div>
                </div>`;
        });
    }

    function addExpense() {
        const desc = document.getElementById('m-desc').value;
        const amt = parseFloat(document.getElementById('m-amt').value);
        const payer = document.getElementById('m-payer').value;
        const targets = Array.from(document.querySelectorAll('.check-item.checked')).map(e => e.innerText);

        if(!desc || isNaN(amt) || targets.length === 0) return;
        
        expenses.unshift({ id: Date.now(), desc, amt, payer, targets });
        localStorage.setItem('khh_v4', JSON.stringify(expenses));
        updateUI();
        document.getElementById('m-desc').value = '';
        document.getElementById('m-amt').value = '';
    }

    function updateUI() {
        const balDiv = document.getElementById('balance-list');
        const histDiv = document.getElementById('history-list');
        const resolveDiv = document.getElementById('resolve-result');
        
        balDiv.innerHTML = '';
        histDiv.innerHTML = '<div style="font-weight:700; margin-bottom:10px;">æ”¯å‡ºç´€éŒ„</div>';
        
        let bals = {};
        members.forEach(m => bals[m] = 0);

        expenses.forEach(e => {
            bals[e.payer] += e.amt;
            let share = e.amt / e.targets.length;
            e.targets.forEach(t => bals[t] -= share);
            histDiv.innerHTML += `
                <div class="card" style="padding:15px; margin-bottom:10px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <div style="font-weight:700;">${e.desc}</div>
                            <div style="font-size:12px; color:var(--apple-secondary);">${e.payer} ä»˜æ¬¾</div>
                        </div>
                        <div style="font-weight:700;">$${Math.round(e.amt)}</div>
                    </div>
                </div>`;
        });

        // å¤«å©¦åˆä½µé‚è¼¯
        let finalBals = { ...bals };
        const coupleSum = finalBals['çª'] + finalBals['Sean'];
        const listToResolve = [];

        Object.keys(finalBals).forEach(m => {
            if (m === 'çª' || m === 'Sean') return;
            listToResolve.push({ name: m, amount: finalBals[m] });
            renderBalanceRow(m, finalBals[m], balDiv);
        });

        renderBalanceRow('çª & Sean â¤ï¸', coupleSum, balDiv);
        listToResolve.push({ name: 'çª & Sean', amount: coupleSum });

        // Debt Resolver
        resolveDiv.innerHTML = '';
        let debtors = listToResolve.filter(x => x.amount < -0.1).sort((a,b) => a.amount - b.amount);
        let creditors = listToResolve.filter(x => x.amount > 0.1).sort((a,b) => b.amount - a.amount);

        if (debtors.length === 0) resolveDiv.innerHTML = "æ‰€æœ‰å¸³ç›®å·²æ¸…ç©º âœ¨";
        else {
            debtors.forEach(d => {
                let dAmt = Math.abs(d.amount);
                creditors.forEach(c => {
                    if (dAmt <= 0 || c.amount <= 0) return;
                    let settle = Math.min(dAmt, c.amount);
                    resolveDiv.innerHTML += `<b>${d.name}</b> è½‰å¸³ <b>$${Math.round(settle)}</b> çµ¦ <b>${c.name}</b><br>`;
                    dAmt -= settle; c.amount -= settle;
                });
            });
        }
    }

    function renderBalanceRow(name, amt, container) {
        const color = amt >= 0 ? 'var(--apple-green)' : 'var(--apple-red)';
        container.innerHTML += `
            <div class="balance-row">
                <span>${name}</span>
                <span style="color:${color}; font-weight:700;">${amt > 0 ? '+' : ''}${Math.round(amt)}</span>
            </div>`;
    }

    function clearData() { if(confirm('ç¢ºå®šæ¸…é™¤å—ï¼Ÿ')) { expenses=[]; localStorage.setItem('khh_v4', '[]'); updateUI(); } }

    init();
</script>
</body>
</html>
