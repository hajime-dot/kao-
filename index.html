<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Gogogo é«˜é›„ 8äººè¡Œ</title>

<style>
    :root {
        --bg-body: #F7F9FC;
        --bg-card: #FFFFFF;
        --primary: #4ECDC4; 
        --text-main: #2C3E50;
        --text-light: #7F8C8D;
        --radius-m: 14px;
        --shadow-soft: 0 4px 20px rgba(0,0,0,0.05);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
        font-family: -apple-system, sans-serif;
        background-color: var(--bg-body);
        margin: 0; display: flex; justify-content: center;
        height: 100dvh; color: var(--text-main); overflow: hidden;
    }

    #app-container { width: 100%; max-width: 500px; height: 100%; display: flex; flex-direction: column; }
    header { padding: 40px 20px 10px; text-align: center; flex-shrink: 0; }
    h1 { margin: 0; font-size: 24px; font-weight: 800; }

    .top-nav { display: flex; padding: 0 15px; border-bottom: 1px solid rgba(0,0,0,0.05); flex-shrink: 0; }
    .nav-item { flex: 1; text-align: center; padding: 12px 0; font-size: 14px; color: #BDC3C7; cursor: pointer; font-weight: 600; }
    .nav-item.active { color: var(--text-main); border-bottom: 3px solid var(--primary); }

    #main-content { flex: 1; overflow-y: auto; padding: 10px 20px 40px; }
    .section { display: none; animation: fadeIn 0.3s ease; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Itinerary & Cards */
    .date-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; position: sticky; top: 0; background: var(--bg-body); z-index: 5; }
    .date-chip { background: white; padding: 8px 16px; border-radius: 20px; font-size: 13px; white-space: nowrap; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; }
    .date-chip.active { background: var(--text-main); color: white; }
    .card { background: white; border-radius: var(--radius-m); padding: 18px; margin-bottom: 14px; box-shadow: var(--shadow-soft); border-left: 4px solid #ddd; }
    .type-food { border-left-color: #F39C12; }
    .type-spot { border-left-color: #27AE60; }
    .type-transport { border-left-color: #3498DB; }
    .type-hotel { border-left-color: #9B59B6; }
    .must-do { background: #FFF9C4; padding: 8px; border-radius: 8px; font-size: 12px; margin: 10px 0; display: block; }
    .btn-map { float: right; font-size: 12px; background: #EEE; padding: 5px 12px; border-radius: 15px; text-decoration: none; color: #333; font-weight: bold; }

    /* Money Section */
    .input-group { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: var(--shadow-soft); }
    .form-input { width: 100%; padding: 12px; border: 1px solid #EEE; border-radius: 8px; margin-bottom: 10px; }
    .check-grid { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
    .check-item { padding: 6px 12px; border-radius: 20px; background: #F0F2F5; font-size: 12px; cursor: pointer; border: 1px solid transparent; }
    .check-item.checked { background: var(--text-main); color: white; }
    .resolver-box { background: #E8F5E9; padding: 15px; border-radius: 12px; margin-top: 20px; border: 1px dashed #2E7D32; }
    .couple-tag { font-size: 10px; background: #FFEBEE; color: #C62828; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
</style>
</head>
<body>

<div id="app-container">
    <header><h1>Gogogo é«˜é›„ ğŸ‡¹ğŸ‡¼</h1></header>
    <nav class="top-nav">
        <div class="nav-item active" onclick="switchTab('sec-itinerary', this)">è¡Œç¨‹</div>
        <div class="nav-item" onclick="switchTab('sec-money', this)">å…¬æ•¸çµç®—</div>
        <div class="nav-item" onclick="switchTab('sec-info', this)">è³‡è¨Š</div>
    </nav>

    <div id="main-content">
        <div id="sec-itinerary" class="section active">
            <div class="date-scroll" id="date-tabs"></div>
            <div id="cards-container"></div>
        </div>

        <div id="sec-money" class="section">
            <div class="input-group">
                <input type="text" id="m-desc" class="form-input" placeholder="æ¶ˆè²»é …ç›® (e.g. ç‡’è‚‰æ™šé¤)">
                <div style="display:flex; gap:10px;">
                    <input type="number" id="m-amt" class="form-input" placeholder="å°å¹£é‡‘é¡">
                    <select id="m-payer" class="form-input"></select>
                </div>
                <div style="font-size:12px; color:#666; margin-bottom:5px;">èª°å¾—åˆ†æ“”ï¼Ÿ 
                    <button onclick="toggleChecks(true)" style="border:none; background:none; color:blue; font-size:11px;">å…¨é¸</button> | 
                    <button onclick="toggleChecks(false)" style="border:none; background:none; color:blue; font-size:11px;">æ¸…ç©º</button>
                </div>
                <div id="m-targets" class="check-grid"></div>
                <button onclick="addExpense()" style="width:100%; padding:12px; background:var(--text-main); color:white; border:none; border-radius:10px; font-weight:bold;">è¨˜ä¸€ç­†</button>
            </div>

            <div id="balance-list" style="margin-bottom:20px;"></div>
            
            <div id="resolver-container" class="resolver-box">
                <div style="font-weight:bold; margin-bottom:10px; display:flex; justify-content:space-between;">
                    <span>ğŸ’¡ æœ€çµ‚é‚„éŒ¢å»ºè­° (Debt Resolver)</span>
                    <span style="font-size:11px; color:#C62828;">â¤ï¸ çª & Sean å·²åˆä½µ</span>
                </div>
                <div id="resolve-result" style="font-size:14px; line-height:1.8;"></div>
            </div>

            <div id="history-list" style="margin-top:20px; border-top:1px solid #EEE; padding-top:10px;"></div>
            <button onclick="clearData()" style="width:100%; margin-top:30px; color:#CCC; background:none; border:none;">æ¸…é™¤æ­·å²ç´€éŒ„</button>
        </div>

        <div id="sec-info" class="section">
            <div class="card type-hotel">
                <div style="font-weight:bold;">æ„›æ²³â€§æ—¥å¤® B&B</div>
                <div style="font-size:13px; color:#666;">é«˜é›„å¸‚å‰é‡‘å€å¸‚ä¸­ä¸€è·¯229è™Ÿ</div>
                <a href="https://www.google.com/maps/search/?api=1&query=æ„›æ²³æ—¥å¤®" target="_blank" style="display:inline-block; margin-top:10px; color:var(--primary);">ğŸ“ æ‰“é–‹ Google Maps</a>
            </div>
        </div>
    </div>
</div>

<script>
    const members = ['æ°´', 'é‚¦', 'å¥', 'åˆ', 'æŸ', 'Boyi', 'çª', 'Sean'];
    const itinerary = [
        { date: "19/2", events: [
            { time: "10:30", title: "èµ·é£› HKG->KHH", type: "transport", desc: "å¥æ°´æŸé‚¦ CI934", must: "Check Passport & Sim Card" },
            { time: "15:00", title: "Check-in ä¼‘æ¯", type: "hotel", desc: "æ„›æ²³æ—¥å¤® B&B", loc: "æ„›æ²³æ—¥å¤®", must: "æ”¾ä½è¡Œæï¼Œå‰ä¸‹é›»å…ˆ" }
        ]},
        { date: "23/2", events: [
            { time: "09:00", title: "æ™¨é–“å»šæˆ¿", type: "food", desc: "æœ€å¾Œæ—©é¤", must: "å¿…é»ç‚’æ³¡éºµï¼" },
            { time: "12:45", title: "Boyi é£›æ©Ÿ (VJ885)", type: "transport", loc: "é«˜é›„å°æ¸¯æ©Ÿå ´", must: "å¹³å®‰è¿”å» SGN" }
        ]}
    ];

    let expenses = JSON.parse(localStorage.getItem('khh_v3')) || [];

    function init() {
        renderDateTabs();
        renderCards(0);
        const pSel = document.getElementById('m-payer');
        const tBox = document.getElementById('m-targets');
        members.forEach(m => {
            pSel.innerHTML += `<option value="${m}">${m}${ (m==='çª'||m==='Sean')?' â¤ï¸':'' }</option>`;
            tBox.innerHTML += `<div class="check-item checked" onclick="this.classList.toggle('checked')">${m}</div>`;
        });
        updateUI();
    }

    function switchTab(id, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    function renderDateTabs() {
        const c = document.getElementById('date-tabs');
        itinerary.forEach((d, i) => {
            const chip = document.createElement('div');
            chip.className = `date-chip ${i===0?'active':''}`;
            chip.innerText = d.date;
            chip.onclick = () => {
                document.querySelectorAll('.date-chip').forEach(x=>x.classList.remove('active'));
                chip.classList.add('active');
                renderCards(i);
            };
            c.appendChild(chip);
        });
    }

    function renderCards(idx) {
        const c = document.getElementById('cards-container');
        c.innerHTML = '';
        itinerary[idx].events.forEach(ev => {
            const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.loc || ev.title)}`;
            c.innerHTML += `
                <div class="card type-${ev.type}">
                    <a href="${mapUrl}" target="_blank" class="btn-map">åœ°åœ–</a>
                    <div style="font-weight:800;">${ev.time} ${ev.title}</div>
                    <div style="font-size:13px; color:#666;">${ev.desc}</div>
                    <div class="must-do">ğŸ’¡ Must Do: ${ev.must}</div>
                </div>`;
        });
    }

    function toggleChecks(val) {
        document.querySelectorAll('.check-item').forEach(el => val ? el.classList.add('checked') : el.classList.remove('checked'));
    }

    function addExpense() {
        const desc = document.getElementById('m-desc').value;
        const amt = parseFloat(document.getElementById('m-amt').value);
        const payer = document.getElementById('m-payer').value;
        const targets = Array.from(document.querySelectorAll('.check-item.checked')).map(e => e.innerText);

        if(!desc || isNaN(amt) || targets.length === 0) return alert('è«‹å¡«å¥½è³‡æ–™');
        
        expenses.unshift({ id: Date.now(), desc, amt, payer, targets });
        localStorage.setItem('khh_v3', JSON.stringify(expenses));
        updateUI();
        document.getElementById('m-desc').value = '';
        document.getElementById('m-amt').value = '';
    }

    function updateUI() {
        const balDiv = document.getElementById('balance-list');
        const histDiv = document.getElementById('history-list');
        const resolveDiv = document.getElementById('resolve-result');
        
        balDiv.innerHTML = '<h3>å€‹äººçµé¤˜ (å°å¹£)</h3>';
        histDiv.innerHTML = '<h3>æ­·å²ç´€éŒ„</h3>';
        
        let bals = {};
        members.forEach(m => bals[m] = 0);

        expenses.forEach(e => {
            bals[e.payer] += e.amt;
            let share = e.amt / e.targets.length;
            e.targets.forEach(t => bals[t] -= share);
            histDiv.innerHTML += `<div style="font-size:12px; border-bottom:1px solid #EEE; padding:5px 0;">${e.desc}: ${e.payer} ä»˜ $${e.amt} (åˆ†æ“”: ${e.targets.join(',')})</div>`;
        });

        // åˆä½µå¤«å©¦å¸³ç›®: çª + Sean
        let finalBals = { ...bals };
        const coupleSum = finalBals['çª'] + finalBals['Sean'];
        const listToResolve = [];

        Object.keys(finalBals).forEach(m => {
            if (m === 'çª' || m === 'Sean') return;
            listToResolve.push({ name: m, amount: finalBals[m] });
            const color = finalBals[m] >= 0 ? 'green' : 'red';
            balDiv.innerHTML += `<div>${m}: <b style="color:${color}">${Math.round(finalBals[m])}</b></div>`;
        });

        // é¡¯ç¤ºåˆä½µå¾Œçš„å¤«å©¦
        const coupleColor = coupleSum >= 0 ? 'green' : 'red';
        balDiv.innerHTML += `<div>çª & Sean (å¤«å©¦): <b style="color:${coupleColor}">${Math.round(coupleSum)}</b></div>`;
        listToResolve.push({ name: 'çª & Sean', amount: coupleSum });

        // Debt Resolver ç®—æ³•
        resolveDiv.innerHTML = '';
        let debtors = listToResolve.filter(x => x.amount < -0.1).sort((a,b) => a.amount - b.amount);
        let creditors = listToResolve.filter(x => x.amount > 0.1).sort((a,b) => b.amount - a.amount);

        if (debtors.length === 0) {
            resolveDiv.innerHTML = "ğŸ‰ æ‰€æœ‰å¸³ç›®å·²æ¸…ï¼";
        } else {
            debtors.forEach(d => {
                let dAmt = Math.abs(d.amount);
                creditors.forEach(c => {
                    if (dAmt <= 0) return;
                    if (c.amount <= 0) return;
                    let settle = Math.min(dAmt, c.amount);
                    resolveDiv.innerHTML += `â¡ï¸ <b>${d.name}</b> ä¿¾ $${Math.round(settle)} ä¿¾ <b>${c.name}</b><br>`;
                    dAmt -= settle;
                    c.amount -= settle;
                });
            });
        }
    }

    function clearData() { if(confirm('æ¸…é™¤æ‰€æœ‰è¨˜å¸³ï¼Ÿ')) { expenses=[]; localStorage.setItem('khh_v3', '[]'); updateUI(); } }

    init();
</script>
</body>
</html>
