<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Gogogo é«˜é›„</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#FFFFFF">

<style>
    :root {
        --bg-body: #F7F9FC;
        --bg-card: #FFFFFF;
        
        --primary: #4ECDC4; 
        --primary-dark: #36B0A8;
        --secondary: #FF6B6B; 
        
        --text-main: #2C3E50;
        --text-light: #7F8C8D;
        --text-lighter: #BDC3C7;

        --shadow-soft: 0 4px 20px rgba(0,0,0,0.05);
        --radius-l: 20px;
        --radius-m: 14px;
        --radius-s: 8px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg-body);
        margin: 0; padding: 0;
        display: flex; justify-content: center;
        height: 100dvh; color: var(--text-main);
        overflow: hidden;
    }

    #app-container {
        width: 100%; max-width: 500px;
        background-color: var(--bg-body);
        height: 100%; position: relative;
        display: flex; flex-direction: column;
    }

    /* --- 1. Header (Static) --- */
    header { 
        padding: 40px 20px 10px; 
        background: var(--bg-body);
        flex-shrink: 0;
        text-align: center;
    }
    h1 { 
        margin: 0; font-size: 24px; font-weight: 800; 
        color: var(--text-main); letter-spacing: 1px;
    }

    /* --- 2. Top Nav (Tabs) --- */
    .top-nav {
        display: flex; padding: 0 15px; margin-bottom: 5px;
        background: var(--bg-body); flex-shrink: 0;
        position: relative; z-index: 10;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .nav-item {
        flex: 1; text-align: center; padding: 12px 0;
        font-size: 14px; font-weight: 600; color: var(--text-lighter);
        cursor: pointer; position: relative; transition: color 0.2s;
    }
    .nav-item.active { color: var(--text-main); font-weight: 700; }
    .nav-item.active::after {
        content: ''; position: absolute; bottom: 0; left: 25%; right: 25%;
        height: 3px; background: var(--primary); border-radius: 3px 3px 0 0;
    }

    /* --- 3. Content Area --- */
    #main-content {
        flex: 1; overflow-y: auto;
        padding: 10px 20px 40px; 
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }
    #main-content::-webkit-scrollbar { display: none; }

    .section { display: none; animation: fadeIn 0.3s ease; }
    .section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    /* --- Itinerary Components --- */
    .date-scroll {
        display: flex; gap: 10px; overflow-x: auto; 
        padding: 10px 2px 15px; position: sticky; top: 0;
        background: var(--bg-body); z-index: 5;
    }
    .date-scroll::-webkit-scrollbar { display: none; }
    
    .date-chip {
        background: white; padding: 10px 16px; border-radius: 20px;
        font-size: 13px; white-space: nowrap; color: var(--text-light);
        box-shadow: 0 2px 8px rgba(0,0,0,0.03); font-weight: 600;
        border: 1px solid transparent; transition: all 0.2s;
    }
    .date-chip.active { 
        background: var(--text-main); color: white; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateY(-1px);
    }

    .card {
        background: var(--bg-card); border-radius: var(--radius-m); padding: 18px;
        margin-bottom: 14px; box-shadow: var(--shadow-soft);
        position: relative; border-left: 4px solid #ddd;
    }
    
    /* Card Types */
    .type-food { border-left-color: #F39C12; }
    .type-spot { border-left-color: #27AE60; }
    .type-transport { border-left-color: #3498DB; background: #F8FBFF; }
    .type-hotel { border-left-color: #9B59B6; }

    .card-row-top { display: flex; justify-content: space-between; margin-bottom: 6px; }
    .card-time { font-family: monospace; font-size: 14px; font-weight: 700; color: var(--text-main); }
    
    .card-title { font-size: 16px; font-weight: 800; color: var(--text-main); margin-bottom: 6px; line-height: 1.4; }
    .card-desc { font-size: 13px; color: var(--text-light); line-height: 1.5; margin-bottom: 8px; }

    /* Tags */
    .tags-row { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
    .tag { font-size: 10px; padding: 4px 8px; border-radius: 6px; font-weight: 700; text-transform: uppercase; }
    .tag-walk { background: #E8F5E9; color: #2E7D32; } /* Walking */
    .tag-uber { background: #E8EAF6; color: #3F51B5; } /* Car/Uber */
    .tag-metro { background: #FFF3E0; color: #E67E22; } /* Public Transport */
    .tag-book { background: #FFEBEE; color: #C0392B; } /* Booking */

    /* Must Do Box */
    .must-do-box {
        margin-top: 12px; padding: 8px 12px;
        background: #FFFDE7; color: #795548;
        font-size: 12px; border-radius: 8px;
        display: flex; align-items: flex-start; gap: 6px;
        line-height: 1.4; font-weight: 500;
        border: 1px solid #FFF59D;
    }

    .btn-map { 
        float: right; margin-top: -5px; font-size: 12px; 
        background: #F0F3F4; padding: 6px 12px; border-radius: 20px; 
        color: var(--text-main); text-decoration: none; font-weight: 600; 
    }
    .btn-map-info {
        display: inline-block; font-size: 13px; 
        background: var(--primary); color: white;
        padding: 8px 16px; border-radius: 20px;
        text-decoration: none; font-weight: bold;
        margin-top: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* --- Money Section --- */
    .input-group { background: white; padding: 20px; border-radius: var(--radius-l); box-shadow: var(--shadow-soft); margin-bottom: 20px; }
    .form-input { width: 100%; padding: 12px; border: 1px solid #EEE; border-radius: 10px; margin-bottom: 10px; font-size: 15px; }
    .check-grid { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0 15px; }
    .check-item { padding: 6px 12px; border-radius: 15px; background: #F5F7FA; font-size: 12px; color: #999; cursor: pointer; border: 1px solid transparent; }
    .check-item.checked { background: var(--text-main); color: white; border-color: var(--text-main); }
    
    .sel-btn-row { display: flex; gap: 10px; margin-bottom: 8px; }
    .sel-btn { font-size: 11px; padding: 4px 10px; background: #EEE; border:none; border-radius: 4px; color: #666; cursor: pointer; }

    /* New Resolver Box */
    .resolver-box {
        background: #E8F5E9; 
        border: 1px dashed #66BB6A;
        padding: 15px; 
        border-radius: var(--radius-m); 
        margin-bottom: 20px;
    }

    /* --- Countdown Section --- */
    #sec-countdown { text-align: center; padding-top: 40px; }
    .cd-circle {
        width: 220px; height: 220px; margin: 0 auto 30px;
        border-radius: 50%; border: 4px solid var(--primary);
        display: flex; flex-direction: column; justify-content: center;
        box-shadow: 0 10px 30px rgba(78, 205, 196, 0.3);
    }
    .cd-num { font-size: 60px; font-weight: 800; color: var(--text-main); line-height: 1; }
    .cd-txt { font-size: 14px; color: var(--text-light); text-transform: uppercase; letter-spacing: 2px; }

</style>
</head>
<body>

<div id="app-container">
    <header>
        <h1>Gogogo é«˜é›„ ğŸ‡¹ğŸ‡¼</h1>
    </header>

    <nav class="top-nav">
        <div class="nav-item active" onclick="switchTab('sec-itinerary', this)">è¡Œç¨‹</div>
        <div class="nav-item" onclick="switchTab('sec-money', this)">å…¬æ•¸</div>
        <div class="nav-item" onclick="switchTab('sec-countdown', this)">å€’æ•¸</div>
        <div class="nav-item" onclick="switchTab('sec-info', this)">è³‡è¨Š</div>
    </nav>

    <div id="main-content">
        
        <div id="sec-itinerary" class="section active">
            <div class="date-scroll" id="date-tabs"></div>
            <div id="cards-container"></div>
        </div>

        <div id="sec-money" class="section">
            <div class="input-group">
                <input type="text" id="m-desc" class="form-input" placeholder="æ¶ˆè²»é …ç›® (e.g. æ™šé¤)">
                <div style="display:flex; gap:10px;">
                    <input type="number" id="m-amt" class="form-input" placeholder="é‡‘é¡ ($)">
                    <select id="m-payer" class="form-input"><option>ä»˜æ¬¾äºº</option></select>
                </div>
                
                <div class="sel-btn-row">
                    <button class="sel-btn" onclick="toggleAllChecks(true)">å…¨é¸</button>
                    <button class="sel-btn" onclick="toggleAllChecks(false)">å…¨ä¸é¸</button>
                </div>
                <div id="m-targets" class="check-grid"></div>
                
                <button onclick="addExpense()" style="width:100%; padding:12px; background:var(--text-main); color:white; border:none; border-radius:10px; font-weight:bold;">è¨˜å¸³</button>
            </div>
            
            <div id="resolver-container" class="resolver-box">
                <div style="font-weight:bold; margin-bottom:10px; font-size:14px; color:#2E7D32;">ğŸ’¡ å»ºè­°çµç®— (çª & Sean åˆä½µ)</div>
                <div id="resolve-list" style="font-size:13px; line-height:1.6;"></div>
                
                <button onclick="shareSettlement()" style="width:100%; margin-top:15px; background:#25D366; color:white; border:none; padding:10px; border-radius:10px; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:8px; cursor:pointer;">
                    <span style="font-size:16px;">ğŸ’¬</span> ç™¼é€çµç®—å–®åˆ° Group
                </button>
            </div>

            <div style="margin-bottom:10px; font-weight:bold; font-size:14px;">å„äººçµé¤˜ (è² æ•¸=æ¬ éŒ¢)</div>
            <div id="balance-list" style="margin-bottom:20px;"></div>
            
            <div style="margin-bottom:10px; font-weight:bold; font-size:14px;">æ­·å²ç´€éŒ„</div>
            <div id="history-list"></div>
            <button onclick="clearAllData()" style="width:100%; margin-top:20px; background:none; border:none; color:#ccc;">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>
        </div>

        <div id="sec-countdown" class="section">
            <div id="pre-flight">
                <div class="cd-circle">
                    <div class="cd-num" id="cd-d">--</div>
                    <div class="cd-txt">Days Left</div>
                </div>
                <div style="font-size:18px; color:var(--text-main); font-weight:600;">è·é›¢ 2æœˆ19æ—¥ å‡ºç™¼</div>
                <div style="font-family:monospace; margin-top:10px; color:var(--primary-dark); font-size:20px;">
                    <span id="cd-h">00</span>:<span id="cd-m">00</span>:<span id="cd-s">00</span>
                </div>
            </div>
            <div id="post-flight" style="display:none;">
                <div style="font-size:80px;">ğŸ‰</div>
                <h2>æ—…é€”æ„‰å¿«!</h2>
                <p>Welcome to Kaohsiung</p>
            </div>
        </div>

        <div id="sec-info" class="section">
            <div class="card type-hotel">
                <div class="card-title">æ„›æ²³â€§æ—¥å¤® B&B</div>
                <div class="card-desc">é«˜é›„å¸‚å‰é‡‘å€ â€¢ Check-in 15:00</div>
                <a href="https://www.google.com/maps/search/?api=1&query=%E6%84%9B%E6%B2%B3%E6%97%A5%E5%A4%AE%20%E9%AB%98%E9%9B%84" target="_blank" class="btn-map-info">ğŸ“ å°èˆªè‡³æ°‘å®¿</a>
            </div>
            <div class="card type-transport">
                <div class="card-title">èˆªç­è³‡è¨Š</div>
                <div class="card-desc">
                    <b>HKG â†” KHH (CI934/CI935)</b><br>
                    å»ç¨‹: 19/2 10:30 (å¥æ°´æŸé‚¦)<br>
                    å›ç¨‹: 23/2 18:00 (å…¨å“¡)<br><br>
                    <b>SGN â†” KHH (VJ886/VJ885)</b><br>
                    Boyi: 19/2 07:35 æŠµé” / 23/2 12:45 é›¢é–‹
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // === Data & Config ===
    const members = ['æ°´', 'é‚¦', 'å¥', 'åˆ', 'æŸ', 'Boyi', 'çª', 'Sean'];
    
    // Helper to generate tag HTML based on content
    const makeTags = (list) => {
        if(!list) return '';
        return list.map(t => {
            let cls = 'tag-metro';
            if(t.includes('è¡Œ')) cls = 'tag-walk';
            if(t.includes('Uber') || t.includes('è»Š')) cls = 'tag-uber';
            if(t.includes('book') || t.includes('Book')) cls = 'tag-book';
            return `<span class="tag ${cls}">${t}</span>`;
        }).join('');
    };

    const itinerary = [
        {
            date: "19/2 (å››)",
            events: [
                { time: "10:30", end: "12:00", title: "èµ·é£› HKG->KHH", type: "transport", desc: "å¥æ°´æŸé‚¦å‡ºç™¼ (CI934)", tags: ["HKG Airport"], must: "Check passport! è²·å®š Sim å¡" },
                { time: "13:00", end: "14:00", title: "å°æ¸¯æ©Ÿå ´é›†åˆ", type: "transport", desc: "èˆ‡ Boyi æœƒåˆ", tags: ["KHH Airport"], must: "é ˜éŒ¢ / æ‚ éŠå¡åŠ å€¼" },
                { time: "15:00", end: "", title: "Check-in ä¼‘æ¯", type: "hotel", desc: "æ„›æ²³æ—¥å¤® B&B", tags: ["Uber"], loc: "æ„›æ²³æ—¥å¤®", must: "æ”¾ä½è¡Œæï¼Œäº«å—è¨­è¨ˆæ„Ÿç©ºé–“" },
                { time: "19:30", end: "21:30", title: "é…’è‚‰æ­¦æ—", type: "food", desc: "ç‡’è‚‰æ™šé¤", tags: ["Booking", "Uber"], must: "å¿…é»ï¼šå£ºæ¼¬ç‰›è‚‹æ¢ã€è”¥é¹½ç‰›èˆŒ" }
            ]
        },
        {
            date: "20/2 (äº”)",
            events: [
                { time: "07:30", end: "08:30", title: "æ¢³æ´—", type: "hotel", desc: "æº–å‚™å‡ºé–€", tags: [], must: "è¨˜å¾—æ½é˜²æ›¬" },
                { time: "08:30", end: "09:30", title: "å¤§ã„ã„¡èƒ–ç¢³çƒ¤ä¸‰æ˜æ²»", type: "food", desc: "äººæ°£æ—©é¤", tags: ["è¡Œ 6åˆ†é˜"], must: "æ‹›ç‰Œç¢³çƒ¤åœŸå¸ + é®®å¥¶èŒ¶" },
                { time: "10:00", end: "11:45", title: "é§äºŒè—è¡“ç‰¹å€", type: "spot", desc: "æ–‡å‰µåœ’å€æ¼«æ­¥", tags: ["è¡Œ 14åˆ†é˜"], must: "å¾®ç†±å±±ä¸˜æ‹¿é³³æ¢¨é…¥ã€å¤§æ¸¯æ©‹æ‰“å¡" },
                { time: "12:00", end: "13:00", title: "CODA coffee", type: "food", desc: "åˆé¤æ™‚é–“", tags: ["è¡Œ 6åˆ†é˜"], must: "æ‰‹æ²–å’–å•¡ / è‚‰æ¡‚æ²" },
                { time: "13:30", end: "16:30", title: "å£½å±±å‹•ç‰©åœ’", type: "spot", desc: "Join åˆã€çªã€æ­¡è»Š", tags: ["Bus 56A"], must: "æ¢è¨ªæ°´è±šå›ã€æ­ä¹˜éŠåœ’å°ç«è»Š" },
                { time: "17:15", end: "19:00", title: "æ–°å €æ±Ÿå•†åœˆ / å¤¾å­åœ’", type: "spot", desc: "é’èœæ¨‚åœ’", tags: ["Bus 56A", "Uber 15m"], must: "å¤¾é›¶é£Ÿã€å¤©ä½¿é›æ’" },
                { time: "19:40", end: "21:30", title: "éŠ…èŠ±ç²¾ç·»æ¶®æ¶®é‹", type: "food", desc: "è±ªè¯ç«é‹", tags: ["Booked", "Uber 24m"], loc: "éŠ…èŠ±ç²¾ç·»æ¶®æ¶®é‹ é«˜é›„ç¾è¡“é¤¨åº—", must: "æœ€å¾Œçš„é»ƒé‡‘ç¨€é£¯ (é›œç‚Š) æ˜¯æœ¬é«”" },
                { time: "22:00", end: "~~", title: "è¿”å»ä¼‘æ¯", type: "hotel", desc: "æ™šå®‰", tags: ["Uber 15m"], loc: "æ„›æ²³æ—¥å¤®", must: "æŠ¬è…¿ä¼‘æ¯" }
            ]
        },
        {
            date: "21/2 (å…­)",
            events: [
                { time: "07:30", end: "08:30", title: "æ¢³æ´—", type: "hotel", desc: "Good Morning", tags: [], must: "å¸¶è¡Œå‹•é›»æº" },
                { time: "09:00", end: "10:00", title: "èˆˆéš†å±…", type: "food", desc: "å‚³çµ±æ—©é¤", tags: ["è¡Œ 15åˆ†é˜"], must: "å¿…é£Ÿæ¹¯åŒ… (è¦æ’éšŠ)ã€ç‡’é¤…" },
                { time: "10:30", end: "12:00", title: "Mystoto å¯†å®¤é€ƒè„«", type: "spot", desc: "ç‡’è…¦æ™‚é–“", tags: ["Booked", "è¼•è»Œ C205"], must: "å…¨é«”åˆä½œï¼Œä¸è¦åµæ¶ XD" },
                { time: "12:10", end: "13:00", title: "ç‚¸è¨˜ (Lunch)", type: "food", desc: "åˆé¤", tags: ["è¡Œ 10åˆ†é˜"], must: "é…¥è„†ç‚¸é›è£œå……ç†±é‡" },
                { time: "13:30", end: "18:45", title: "SKM Park / è³½é“æ¨‚åœ’", type: "spot", desc: "Outlet + å¡ä¸è»Š", tags: ["ç´…ç·š->è‰è¡™ç«™"], must: "éˆ´é¹¿è³½é“å¡ä¸è»Šé£†è»Šã€è²·é‹" },
                { time: "19:15", end: "20:30", title: "è‡ªå¼·å¤œå¸‚ / è‹“é›…å¸‚å ´", type: "food", desc: "åœ¨åœ°å°åƒæ™šé¤", tags: ["ç´…ç·š->ä¸‰å¤š"], must: "å—è±é­¯è‚‰é£¯ã€ç™½ç³–ç²¿" },
                { time: "21:00", end: "22:15", title: "è¶Šå¼æ´—é«®", type: "spot", desc: "ä¸æƒ³æ´—é ­ (SPA)", tags: ["Booked", "Uber 14m"], must: "å…¨å¥—æ”¾é¬† SPA" },
                { time: "22:30", end: "~~", title: "è¿”å»ä¼‘æ¯", type: "hotel", desc: "æ™šå®‰", tags: ["Uber 9m"], loc: "æ„›æ²³æ—¥å¤®", must: "æ•·å€‹é¢è†œ" }
            ]
        },
        {
            date: "22/2 (æ—¥)",
            events: [
                { time: "09:00", end: "10:00", title: "æ¢³æ´—", type: "hotel", desc: "æº–å‚™å‡ºé–€", tags: [] },
                { time: "10:00", end: "11:00", title: "å¤§ç”°æ—©é¤åº—", type: "food", desc: "æ—©é¤", tags: ["è¡Œ 3åˆ†é˜"], must: "å¤æ—©å‘³ç²‰æ¼¿è›‹é¤…" },
                { time: "12:00", end: "13:15", title: "æ——å±±è€è¡—", type: "spot", desc: "é€›è€è¡—", tags: ["Uber 50m"], must: "é¦™è•‰è›‹ç³• / æä»”å†°åŸ" },
                { time: "13:45", end: "15:00", title: "æ°¸å®‰è€è¡—", type: "spot", desc: "ç¾æ¿ƒå¤è¹Ÿ", tags: ["Uber 15m"], must: "å®¢å®¶å»ºç¯‰" },
                { time: "15:15", end: "16:15", title: "ç¾æ¿ƒæ¹–", type: "spot", desc: "æ¹–ç•”æ•£æ­¥", tags: ["Uber 5m"], must: "ç’°æ¹–æ­¥é“" },
                { time: "16:30", end: "17:20", title: "ç¾æ¿ƒæ°‘ä¿—æ‘", type: "spot", desc: "æ–‡åŒ–é«”é©—", tags: ["Uber 10m"], must: "å®¢å®¶æ“‚èŒ¶" },
                { time: "17:40", end: "19:10", title: "é˜¿é¦™çš„å»šæˆ¿", type: "food", desc: "åŸä½æ°‘æ–™ç† (è¾¦æ¡Œ)", tags: ["Booked", "Uber 10m"], must: "åˆºè”¥çƒ˜è›‹ã€å±±è±¬è‚‰" },
                { time: "20:30", end: "~~", title: "è¿”å»ä¼‘æ¯", type: "hotel", desc: "æ•´ç†è¡Œæ", tags: ["Uber"], loc: "æ„›æ²³æ—¥å¤®", must: "ç¢ºèªè­·ç…§ã€åŸ·è¡Œæ" }
            ]
        },
        {
            date: "23/2 (ä¸€)",
            events: [
                { time: "07:30", end: "09:00", title: "Check-out", type: "hotel", desc: "æ”¶æ‹¾è¡Œæ", tags: [], must: "æª¢æŸ¥æœ‰ç„¡éºç•™ç‰©å“" },
                { time: "09:00", end: "10:00", title: "æ™¨é–“å»šæˆ¿", type: "food", desc: "æœ€å¾Œæ—©é¤", tags: ["å‰é‡‘æˆåŠŸåº—"], must: "ç‚’æ³¡éºµã€è›‹é¤…" },
                { time: "12:45", end: "", title: "Boyi é£›æ©Ÿ (VJ885)", type: "transport", desc: "å¹³å®‰å›å®¶", tags: ["To SGN"], loc: "é«˜é›„å°æ¸¯æ©Ÿå ´", must: "Safe Flight!" },
                { time: "16:00", end: "", title: "HKçµ„ æ©Ÿå ´å ±åˆ°", type: "transport", desc: "CI935", tags: ["KHH Airport"], loc: "é«˜é›„å°æ¸¯æ©Ÿå ´", must: "æœ€å¾Œè¡åˆºè²·æ‰‹ä¿¡" }
            ]
        }
    ];

    // === App Logic ===
    function init() {
        renderDateTabs();
        renderCards(0);
        initMoney();
        startCountdown();
    }

    function switchTab(secId, navEl) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(secId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        navEl.classList.add('active');
    }

    // --- Itinerary ---
    function renderDateTabs() {
        const c = document.getElementById('date-tabs');
        itinerary.forEach((d, i) => {
            const chip = document.createElement('div');
            chip.className = `date-chip ${i===0?'active':''}`;
            chip.innerText = d.date.split(' ')[0];
            chip.onclick = () => {
                document.querySelectorAll('.date-chip').forEach(x=>x.classList.remove('active'));
                chip.classList.add('active');
                renderCards(i);
            }
            c.appendChild(chip);
        });
    }

    function renderCards(idx) {
        const c = document.getElementById('cards-container');
        c.innerHTML = '';
        const day = itinerary[idx];
        day.events.forEach(ev => {
            const card = document.createElement('div');
            card.className = `card type-${ev.type}`;
            
            // Time logic
            let timeHtml = `<span class="card-time">${ev.time}</span>`;
            if(ev.end) timeHtml += `<span style="font-size:12px; color:#999; margin-left:5px;">- ${ev.end}</span>`;
            
            // Tags logic
            const tagsHtml = ev.tags && ev.tags.length > 0 ? `<div class="tags-row">${makeTags(ev.tags)}</div>` : '';
            
            // Must Do logic
            const mustHtml = ev.must ? `<div class="must-do-box">ğŸ’¡ ${ev.must}</div>` : '';

            // Map link
            const queryLoc = ev.loc ? ev.loc : (ev.title + " é«˜é›„");
            const mapUrl = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent(queryLoc);

            card.innerHTML = `
                <div class="card-row-top">
                    <div>${timeHtml}</div>
                    <a href="${mapUrl}" target="_blank" class="btn-map">GO</a>
                </div>
                <div class="card-title">${ev.title}</div>
                <div class="card-desc">${ev.desc}</div>
                ${mustHtml}
                ${tagsHtml}
            `;
            c.appendChild(card);
        });
    }

    // --- Money ---
    let expenses = JSON.parse(localStorage.getItem('khh_data_v2')) || [];
    function initMoney() {
        const sel = document.getElementById('m-payer');
        const box = document.getElementById('m-targets');
        members.forEach(m => {
            sel.innerHTML += `<option value="${m}">${m}</option>`;
            box.innerHTML += `<div class="check-item checked" onclick="this.classList.toggle('checked')">${m}</div>`;
        });
        updateMoneyUI();
    }
    
    // Select All / None Logic
    window.toggleAllChecks = function(isCheck) {
        document.querySelectorAll('.check-item').forEach(el => {
            if(isCheck) el.classList.add('checked');
            else el.classList.remove('checked');
        });
    }

    window.addExpense = function() {
        const desc = document.getElementById('m-desc').value;
        const amt = parseFloat(document.getElementById('m-amt').value);
        const payer = document.getElementById('m-payer').value;
        const targets = Array.from(document.querySelectorAll('.check-item.checked')).map(e=>e.innerText);
        
        if(!desc || isNaN(amt) || payer === 'ä»˜æ¬¾äºº') return alert('è«‹å¡«å¯«å®Œæ•´');
        if(targets.length === 0) return alert('è«‹è‡³å°‘é¸æ“‡ä¸€äººåˆ†æ“”');

        expenses.unshift({id: Date.now(), desc, amt, payer, targets});
        saveMoney();
        document.getElementById('m-desc').value = '';
        document.getElementById('m-amt').value = '';
    }
    
    function saveMoney() {
        localStorage.setItem('khh_data_v2', JSON.stringify(expenses));
        updateMoneyUI();
    }
    
    window.clearAllData = function() {
        if(confirm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰è¨˜å¸³è³‡æ–™ï¼Ÿ')) { expenses = []; saveMoney(); }
    }
    
    function updateMoneyUI() {
        const list = document.getElementById('history-list');
        const balDiv = document.getElementById('balance-list');
        const resolveDiv = document.getElementById('resolve-list');

        list.innerHTML = '';
        balDiv.innerHTML = '';
        resolveDiv.innerHTML = '';

        // 1. Calculate Individual Balances
        let bals = {}; members.forEach(m => bals[m] = 0);
        
        expenses.forEach(e => {
            bals[e.payer] += e.amt;
            const split = e.amt / e.targets.length;
            e.targets.forEach(t => bals[t] -= split);
            
            list.innerHTML += `
                <div style="padding:10px 0; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                    <div><b>${e.desc}</b> $${e.amt} <span style="font-size:11px; color:#999;">(${e.payer})</span></div>
                    <div style="color:red; cursor:pointer;" onclick="delExp(${e.id})">âœ•</div>
                </div>`;
        });

        // 2. Merge Couples & Prepare for Resolution
        let finalBals = {};
        let coupleSum = 0;
        let resolveList = [];

        Object.keys(bals).forEach(m => {
            // Logic: if person is Kee or Sean, add to coupleSum, else normal
            if(m === 'çª' || m === 'Sean') {
                coupleSum += bals[m];
            } else {
                finalBals[m] = bals[m];
                resolveList.push({ name: m, val: bals[m] });
            }
        });
        
        // Add couple to lists
        finalBals['çª & Sean â¤ï¸'] = coupleSum;
        resolveList.push({ name: 'çª & Sean', val: coupleSum });

        // 3. Render Balance List (Visual)
        Object.keys(finalBals).sort((a,b)=>finalBals[b]-finalBals[a]).forEach(m => {
            const val = Math.round(finalBals[m]);
            if(Math.abs(val) < 1) return; // Skip zero balance
            const color = val > 0 ? '#27AE60' : '#C0392B';
            balDiv.innerHTML += `
                <div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #f9f9f9;">
                    <span>${m}</span>
                    <span style="color:${color}; font-weight:bold;">${val>0?'+':''}${val}</span>
                </div>`;
        });

        // 4. Debt Resolver (Greedy Algorithm)
        let debtors = resolveList.filter(x => x.val < -1).sort((a,b) => a.val - b.val); // Ascending (most debt first)
        let creditors = resolveList.filter(x => x.val > 1).sort((a,b) => b.val - a.val); // Descending (most credit first)

        if(debtors.length === 0 && creditors.length === 0) {
            resolveDiv.innerHTML = "ğŸ‰ ç›®å‰æ²’æœ‰æ¬ æ¬¾ï¼";
        } else {
            debtors.forEach(d => {
                let debtAmt = Math.abs(d.val);
                creditors.forEach(c => {
                    if(debtAmt < 0.1 || c.val < 0.1) return;
                    
                    let settle = Math.min(debtAmt, c.val);
                    resolveDiv.innerHTML += `â¡ï¸ <b>${d.name}</b> ä¿¾ $${Math.round(settle)} ä¿¾ <b>${c.name}</b><br>`;
                    
                    debtAmt -= settle;
                    c.val -= settle;
                });
            });
        }
        
        window.delExp = (id) => { if(confirm('åˆªé™¤?')) { expenses=expenses.filter(x=>x.id!==id); saveMoney(); }};
    }

    // --- Countdown ---
    function startCountdown() {
        const target = new Date("2026-02-19T10:30:00").getTime();
        setInterval(() => {
            const now = new Date().getTime();
            const diff = target - now;
            
            if(diff < 0) {
                document.getElementById('pre-flight').style.display = 'none';
                document.getElementById('post-flight').style.display = 'block';
                return;
            }
            
            document.getElementById('cd-d').innerText = Math.floor(diff / (1000*60*60*24));
            document.getElementById('cd-h').innerText = String(Math.floor((diff % (1000*60*60*24))/(1000*60*60))).padStart(2,'0');
            document.getElementById('cd-m').innerText = String(Math.floor((diff % (1000*60*60))/(1000*60))).padStart(2,'0');
            document.getElementById('cd-s').innerText = String(Math.floor((diff % (1000*60))/1000)).padStart(2,'0');
        }, 1000);
    }

    // === NEW FUNCTION: WhatsApp Settlement Share ===
    function shareSettlement() {
        const div = document.getElementById('resolve-list');
        // Get the text content from the calculated list
        let content = div.innerText;

        // Basic validation
        if (!content || content.trim() === "" || content.includes("ç›®å‰æ²’æœ‰æ¬ æ¬¾")) {
            alert("ç›®å‰é¡¯ç¤ºæ²’æœ‰å‚µå‹™ï¼Œè«‹ç¢ºèªæ˜¯å¦å·²é»æ“Šã€Œè¨ˆç®—ã€æˆ–å¤§å®¶å‰›å¥½å¹³æ‰‹ï¼");
            return;
        }

        // Format the message for WhatsApp
        // innerText automatically converts <br> to newlines in most browsers
        let report = `ğŸ“Š *[Gogogo é«˜é›„ - æœ€çµ‚çµç®—]*\n\n`;
        report += content; 
        report += `\n\n------------------\n`;
        report += `è«‹å¤§å®¶ä¾ç…§é‡‘é¡ PayMe / è½‰æ•¸å¿« çµ¦å°æ–¹å•¦ï¼ğŸ’¸`;

        // Create WhatsApp URL
        const url = `https://wa.me/?text=${encodeURIComponent(report)}`;
        
        // Open WhatsApp
        window.open(url, '_blank');
    }

    init();
</script>
</body>
</html>
